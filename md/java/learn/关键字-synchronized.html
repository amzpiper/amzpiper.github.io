<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>å…³é”®å­—-synchronized | ç§äººçŸ¥è¯†å›¾ä¹¦é¦†</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="åŒ…å«: Java åŸºç¡€, Java éƒ¨åˆ†æºç , JVM, Spring, Spring Boot, Spring Cloud, æ•°æ®åº“åŸç†, MySQL, ElasticSearch, MongoDB, Docker, k8s, CI&amp;CD, Linux, DevOps, åˆ†å¸ƒå¼, ä¸­é—´ä»¶, å¼€å‘å·¥å…·, Git, IDE, æºç é˜…è¯»ï¼Œè¯»ä¹¦ç¬”è®°, å¼€æºé¡¹ç›®...">
    <meta name="robots" content="all">
    <meta name="author" content="pdai">
    <meta name="keywords" content="ç§äººçŸ¥è¯†å›¾ä¹¦é¦†, javaä½“ç³», javaçŸ¥è¯†ä½“ç³», javaæ¡†æ¶,javaè¯¦è§£,javaå­¦ä¹ è·¯çº¿,java spring, javaé¢è¯•, çŸ¥è¯†ä½“ç³», javaæŠ€æœ¯ä½“ç³», javaç¼–ç¨‹, javaç¼–ç¨‹æŒ‡å—,javaå¼€å‘ä½“ç³», javaå¼€å‘,javaæ•™ç¨‹,java,javaæ•°æ®ç»“æ„, ç®—æ³•, å¼€å‘åŸºç¡€">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <link rel="preload" href="/assets/css/0.styles.cb877f3d.css" as="style"><link rel="preload" href="/assets/js/app.27f0b381.js" as="script"><link rel="preload" href="/assets/js/5.ea3a467f.js" as="script"><link rel="preload" href="/assets/js/12.725de989.js" as="script"><link rel="prefetch" href="/assets/js/10.f7d3d75e.js"><link rel="prefetch" href="/assets/js/11.3f596b90.js"><link rel="prefetch" href="/assets/js/13.d6271850.js"><link rel="prefetch" href="/assets/js/14.c1a9019c.js"><link rel="prefetch" href="/assets/js/15.9c9ef26c.js"><link rel="prefetch" href="/assets/js/16.de77b749.js"><link rel="prefetch" href="/assets/js/17.423d042c.js"><link rel="prefetch" href="/assets/js/18.65db727f.js"><link rel="prefetch" href="/assets/js/19.f0cab2cf.js"><link rel="prefetch" href="/assets/js/2.2c55f875.js"><link rel="prefetch" href="/assets/js/20.bc2a1ebe.js"><link rel="prefetch" href="/assets/js/21.9d44366f.js"><link rel="prefetch" href="/assets/js/22.7d11e992.js"><link rel="prefetch" href="/assets/js/23.a2b338c4.js"><link rel="prefetch" href="/assets/js/24.b020e663.js"><link rel="prefetch" href="/assets/js/25.32e88dc5.js"><link rel="prefetch" href="/assets/js/26.d6cf3bce.js"><link rel="prefetch" href="/assets/js/27.304e0d0a.js"><link rel="prefetch" href="/assets/js/28.12e94d0e.js"><link rel="prefetch" href="/assets/js/29.79c71861.js"><link rel="prefetch" href="/assets/js/3.afbede00.js"><link rel="prefetch" href="/assets/js/30.90aec520.js"><link rel="prefetch" href="/assets/js/31.248dcef9.js"><link rel="prefetch" href="/assets/js/32.abc6c660.js"><link rel="prefetch" href="/assets/js/33.90c0c365.js"><link rel="prefetch" href="/assets/js/4.1fed06c3.js"><link rel="prefetch" href="/assets/js/6.ee3d35d1.js"><link rel="prefetch" href="/assets/js/7.702fcf9c.js"><link rel="prefetch" href="/assets/js/8.15f570fb.js"><link rel="prefetch" href="/assets/js/9.bbacd143.js">
    <link rel="stylesheet" href="/assets/css/0.styles.cb877f3d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/favicon.ico" alt="ç§äººçŸ¥è¯†å›¾ä¹¦é¦†" class="logo"> <span class="site-name can-hide">ç§äººçŸ¥è¯†å›¾ä¹¦é¦†</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  æ¦‚è¿°
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å­¦ä¹ ç¬”è®°" class="dropdown-title"><span class="title">å­¦ä¹ ç¬”è®°</span> <span class="arrow down"></span></button> <button type="button" aria-label="å­¦ä¹ ç¬”è®°" class="mobile-dropdown-title"><span class="title">å­¦ä¹ ç¬”è®°</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          å‰ç«¯
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/java/learn/learn-typescript.html" class="nav-link">
  Typescript
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/ChromeExtensions.html" class="nav-link">
  ChromeExtensions
</a></li></ul></li><li class="dropdown-item"><h4>
          Java
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/java/learn/Java8-Stream.html" class="nav-link">
  Stream
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/Java8-Optional.html" class="nav-link">
  Optional
</a></li></ul></li><li class="dropdown-item"><h4>
          Javaé«˜å¹¶å‘
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/java/learn/Javaçº¿ç¨‹æ± .html" class="nav-link">
  Javaçº¿ç¨‹æ± 
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/é«˜å¹¶å‘-çŸ¥è¯†ä½“ç³».html" class="nav-link">
  é«˜å¹¶å‘-çŸ¥è¯†ä½“ç³»
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/é«˜å¹¶å‘-çº¿ç¨‹åŸºç¡€.html" class="nav-link">
  é«˜å¹¶å‘-çº¿ç¨‹åŸºç¡€
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/é«˜å¹¶å‘-ç†è®ºåŸºç¡€.html" class="nav-link">
  é«˜å¹¶å‘-ç†è®ºåŸºç¡€
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/å…³é”®å­—-synchronized.html" class="nav-link">
  å…³é”®å­—-synchronized
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/å…³é”®å­—-volatile.html" class="nav-link">
  å…³é”®å­—-volatile
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/å…³é”®å­—-final.html" class="nav-link">
  å…³é”®å­—-final
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/é«˜å¹¶å‘-ThreadLocalè¯¦è§£.html" class="nav-link">
  é«˜å¹¶å‘-ThreadLocalè¯¦è§£
</a></li></ul></li><li class="dropdown-item"><h4>
          æ¡†æ¶
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/java/learn/Springç¬”è®°.html" class="nav-link">
  Springç¬”è®°
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/Spring-MVCç¬”è®°.html" class="nav-link">
  SpringMVCç¬”è®°
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/Mybatisç¬”è®°.html" class="nav-link">
  Mybatisç¬”è®°
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/MybatisPlusç¬”è®°.html" class="nav-link">
  MybatisPlusç¬”è®°
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/Springç¬”è®°.html" class="nav-link">
  SpringBootç¬”è®°
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/Dubboå­¦ä¹ ç¬”è®°.html" class="nav-link">
  Dubboç¬”è®°
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/learn-zookeeper.html" class="nav-link">
  Zookeeperç¬”è®°
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/learn-redis.html" class="nav-link">
  Redisç¬”è®°
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/learn-elasticstack.html" class="nav-link">
  Elasticstackç¬”è®°
</a></li></ul></li><li class="dropdown-item"><h4>
          JVM
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/java/learn/JVMå¿«é€Ÿå…¥é—¨ç¯‡.html" class="nav-link">
  JVMå¿«é€Ÿå…¥é—¨ç¯‡
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æ–¹æ³•è®º" class="dropdown-title"><span class="title">æ–¹æ³•è®º</span> <span class="arrow down"></span></button> <button type="button" aria-label="æ–¹æ³•è®º" class="mobile-dropdown-title"><span class="title">æ–¹æ³•è®º</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/java/method/è®¾è®¡æ¨¡å¼.html" class="nav-link">
  è®¾è®¡æ¨¡å¼
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç‰ˆæœ¬å·¥å…·" class="dropdown-title"><span class="title">ç‰ˆæœ¬å·¥å…·</span> <span class="arrow down"></span></button> <button type="button" aria-label="ç‰ˆæœ¬å·¥å…·" class="mobile-dropdown-title"><span class="title">ç‰ˆæœ¬å·¥å…·</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/java/tool/Git.html" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/md/java/tool/Mavenå­¦ä¹ ç¬”è®°.html" class="nav-link">
  Maven
</a></li></ul></div></div><div class="nav-item"><a href="/md/about/about-me.html" class="nav-link">
  å…³äº
</a></div><div class="nav-item"><a href="https://github.com/amzpiper" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  æ¦‚è¿°
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å­¦ä¹ ç¬”è®°" class="dropdown-title"><span class="title">å­¦ä¹ ç¬”è®°</span> <span class="arrow down"></span></button> <button type="button" aria-label="å­¦ä¹ ç¬”è®°" class="mobile-dropdown-title"><span class="title">å­¦ä¹ ç¬”è®°</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          å‰ç«¯
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/java/learn/learn-typescript.html" class="nav-link">
  Typescript
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/ChromeExtensions.html" class="nav-link">
  ChromeExtensions
</a></li></ul></li><li class="dropdown-item"><h4>
          Java
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/java/learn/Java8-Stream.html" class="nav-link">
  Stream
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/Java8-Optional.html" class="nav-link">
  Optional
</a></li></ul></li><li class="dropdown-item"><h4>
          Javaé«˜å¹¶å‘
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/java/learn/Javaçº¿ç¨‹æ± .html" class="nav-link">
  Javaçº¿ç¨‹æ± 
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/é«˜å¹¶å‘-çŸ¥è¯†ä½“ç³».html" class="nav-link">
  é«˜å¹¶å‘-çŸ¥è¯†ä½“ç³»
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/é«˜å¹¶å‘-çº¿ç¨‹åŸºç¡€.html" class="nav-link">
  é«˜å¹¶å‘-çº¿ç¨‹åŸºç¡€
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/é«˜å¹¶å‘-ç†è®ºåŸºç¡€.html" class="nav-link">
  é«˜å¹¶å‘-ç†è®ºåŸºç¡€
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/å…³é”®å­—-synchronized.html" class="nav-link">
  å…³é”®å­—-synchronized
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/å…³é”®å­—-volatile.html" class="nav-link">
  å…³é”®å­—-volatile
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/å…³é”®å­—-final.html" class="nav-link">
  å…³é”®å­—-final
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/é«˜å¹¶å‘-ThreadLocalè¯¦è§£.html" class="nav-link">
  é«˜å¹¶å‘-ThreadLocalè¯¦è§£
</a></li></ul></li><li class="dropdown-item"><h4>
          æ¡†æ¶
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/java/learn/Springç¬”è®°.html" class="nav-link">
  Springç¬”è®°
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/Spring-MVCç¬”è®°.html" class="nav-link">
  SpringMVCç¬”è®°
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/Mybatisç¬”è®°.html" class="nav-link">
  Mybatisç¬”è®°
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/MybatisPlusç¬”è®°.html" class="nav-link">
  MybatisPlusç¬”è®°
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/Springç¬”è®°.html" class="nav-link">
  SpringBootç¬”è®°
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/Dubboå­¦ä¹ ç¬”è®°.html" class="nav-link">
  Dubboç¬”è®°
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/learn-zookeeper.html" class="nav-link">
  Zookeeperç¬”è®°
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/learn-redis.html" class="nav-link">
  Redisç¬”è®°
</a></li><li class="dropdown-subitem"><a href="/md/java/learn/learn-elasticstack.html" class="nav-link">
  Elasticstackç¬”è®°
</a></li></ul></li><li class="dropdown-item"><h4>
          JVM
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/java/learn/JVMå¿«é€Ÿå…¥é—¨ç¯‡.html" class="nav-link">
  JVMå¿«é€Ÿå…¥é—¨ç¯‡
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æ–¹æ³•è®º" class="dropdown-title"><span class="title">æ–¹æ³•è®º</span> <span class="arrow down"></span></button> <button type="button" aria-label="æ–¹æ³•è®º" class="mobile-dropdown-title"><span class="title">æ–¹æ³•è®º</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/java/method/è®¾è®¡æ¨¡å¼.html" class="nav-link">
  è®¾è®¡æ¨¡å¼
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç‰ˆæœ¬å·¥å…·" class="dropdown-title"><span class="title">ç‰ˆæœ¬å·¥å…·</span> <span class="arrow down"></span></button> <button type="button" aria-label="ç‰ˆæœ¬å·¥å…·" class="mobile-dropdown-title"><span class="title">ç‰ˆæœ¬å·¥å…·</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/java/tool/Git.html" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/md/java/tool/Mavenå­¦ä¹ ç¬”è®°.html" class="nav-link">
  Maven
</a></li></ul></div></div><div class="nav-item"><a href="/md/about/about-me.html" class="nav-link">
  å…³äº
</a></div><div class="nav-item"><a href="https://github.com/amzpiper" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>å‰ç«¯</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/md/java/learn/learn-typescript.html" class="sidebar-link">TypeScript</a></li><li><a href="/md/java/learn/ChromeExtensions.html" class="sidebar-link">Chrome Extensions</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Java</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/md/java/learn/Java8-Stream.html" class="sidebar-link">Java 8 - Stream</a></li><li><a href="/md/java/learn/Java8-Optional.html" class="sidebar-link">Java 8 - Optional</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Javaé«˜å¹¶å‘</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/md/java/learn/Javaçº¿ç¨‹æ± .html" class="sidebar-link">Java çº¿ç¨‹æ± </a></li><li><a href="/md/java/learn/é«˜å¹¶å‘-çŸ¥è¯†ä½“ç³».html" class="sidebar-link">é«˜å¹¶å‘-çŸ¥è¯†ä½“ç³»</a></li><li><a href="/md/java/learn/é«˜å¹¶å‘-çº¿ç¨‹åŸºç¡€.html" class="sidebar-link">é«˜å¹¶å‘-çº¿ç¨‹åŸºç¡€</a></li><li><a href="/md/java/learn/é«˜å¹¶å‘-ç†è®ºåŸºç¡€.html" class="sidebar-link">é«˜å¹¶å‘-ç†è®ºåŸºç¡€</a></li><li><a href="/md/java/learn/å…³é”®å­—-synchronized.html" class="active sidebar-link">å…³é”®å­—-synchronized</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/md/java/learn/å…³é”®å­—-synchronized.html#å¸¦ç€batå¤§å‚çš„é¢è¯•é—®é¢˜å»ç†è§£synchronized" class="sidebar-link">å¸¦ç€BATå¤§å‚çš„é¢è¯•é—®é¢˜å»ç†è§£Synchronized</a></li><li class="sidebar-sub-header"><a href="/md/java/learn/å…³é”®å­—-synchronized.html#synchronizedçš„ä½¿ç”¨" class="sidebar-link">Synchronizedçš„ä½¿ç”¨</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/md/java/learn/å…³é”®å­—-synchronized.html#å¯¹è±¡é”" class="sidebar-link">å¯¹è±¡é”</a></li><li class="sidebar-sub-header"><a href="/md/java/learn/å…³é”®å­—-synchronized.html#ä»£ç å—å½¢å¼-æ‰‹åŠ¨æŒ‡å®šé”å®šå¯¹è±¡-ä¹Ÿå¯æ˜¯æ˜¯this-ä¹Ÿå¯ä»¥æ˜¯è‡ªå®šä¹‰çš„é”" class="sidebar-link">ä»£ç å—å½¢å¼ï¼šæ‰‹åŠ¨æŒ‡å®šé”å®šå¯¹è±¡ï¼Œä¹Ÿå¯æ˜¯æ˜¯this,ä¹Ÿå¯ä»¥æ˜¯è‡ªå®šä¹‰çš„é”</a></li><li class="sidebar-sub-header"><a href="/md/java/learn/å…³é”®å­—-synchronized.html#æ–¹æ³•é”å½¢å¼-synchronizedä¿®é¥°æ™®é€šæ–¹æ³•-é”å¯¹è±¡é»˜è®¤ä¸ºthis" class="sidebar-link">æ–¹æ³•é”å½¢å¼ï¼šsynchronizedä¿®é¥°æ™®é€šæ–¹æ³•ï¼Œé”å¯¹è±¡é»˜è®¤ä¸ºthis</a></li><li class="sidebar-sub-header"><a href="/md/java/learn/å…³é”®å­—-synchronized.html#ç±»é”" class="sidebar-link">ç±»é”</a></li></ul></li><li class="sidebar-sub-header"><a href="/md/java/learn/å…³é”®å­—-synchronized.html#synchronizedåŸç†åˆ†æ" class="sidebar-link">SynchronizedåŸç†åˆ†æ</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/md/java/learn/å…³é”®å­—-synchronized.html#åŠ é”å’Œé‡Šæ”¾é”çš„åŸç†" class="sidebar-link">åŠ é”å’Œé‡Šæ”¾é”çš„åŸç†</a></li><li class="sidebar-sub-header"><a href="/md/java/learn/å…³é”®å­—-synchronized.html#å¯é‡å…¥åŸç†-åŠ é”æ¬¡æ•°è®¡æ•°å™¨" class="sidebar-link">å¯é‡å…¥åŸç†ï¼šåŠ é”æ¬¡æ•°è®¡æ•°å™¨</a></li><li class="sidebar-sub-header"><a href="/md/java/learn/å…³é”®å­—-synchronized.html#ä¿è¯å¯è§æ€§çš„åŸç†-å†…å­˜æ¨¡å‹å’Œhappens-beforeè§„åˆ™" class="sidebar-link">ä¿è¯å¯è§æ€§çš„åŸç†ï¼šå†…å­˜æ¨¡å‹å’Œhappens-beforeè§„åˆ™</a></li></ul></li><li class="sidebar-sub-header"><a href="/md/java/learn/å…³é”®å­—-synchronized.html#jvmä¸­é”çš„ä¼˜åŒ–" class="sidebar-link">JVMä¸­é”çš„ä¼˜åŒ–</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/md/java/learn/å…³é”®å­—-synchronized.html#é”çš„ç±»å‹" class="sidebar-link">é”çš„ç±»å‹</a></li><li class="sidebar-sub-header"><a href="/md/java/learn/å…³é”®å­—-synchronized.html#è‡ªæ—‹é”ä¸è‡ªé€‚åº”è‡ªæ—‹é”" class="sidebar-link">è‡ªæ—‹é”ä¸è‡ªé€‚åº”è‡ªæ—‹é”</a></li><li class="sidebar-sub-header"><a href="/md/java/learn/å…³é”®å­—-synchronized.html#é”æ¶ˆé™¤" class="sidebar-link">é”æ¶ˆé™¤</a></li><li class="sidebar-sub-header"><a href="/md/java/learn/å…³é”®å­—-synchronized.html#é”ç²—åŒ–" class="sidebar-link">é”ç²—åŒ–</a></li><li class="sidebar-sub-header"><a href="/md/java/learn/å…³é”®å­—-synchronized.html#è½»é‡çº§é”" class="sidebar-link">è½»é‡çº§é”</a></li><li class="sidebar-sub-header"><a href="/md/java/learn/å…³é”®å­—-synchronized.html#åå‘é”" class="sidebar-link">åå‘é”</a></li><li class="sidebar-sub-header"><a href="/md/java/learn/å…³é”®å­—-synchronized.html#é”çš„ä¼˜ç¼ºç‚¹å¯¹æ¯”" class="sidebar-link">é”çš„ä¼˜ç¼ºç‚¹å¯¹æ¯”</a></li></ul></li><li class="sidebar-sub-header"><a href="/md/java/learn/å…³é”®å­—-synchronized.html#synchronizedä¸lock" class="sidebar-link">Synchronizedä¸Lock</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/md/java/learn/å…³é”®å­—-synchronized.html#synchronizedçš„ç¼ºé™·" class="sidebar-link">synchronizedçš„ç¼ºé™·</a></li><li class="sidebar-sub-header"><a href="/md/java/learn/å…³é”®å­—-synchronized.html#lockè§£å†³ç›¸åº”é—®é¢˜" class="sidebar-link">Lockè§£å†³ç›¸åº”é—®é¢˜</a></li></ul></li><li class="sidebar-sub-header"><a href="/md/java/learn/å…³é”®å­—-synchronized.html#å†æ·±å…¥ç†è§£" class="sidebar-link">å†æ·±å…¥ç†è§£</a></li><li class="sidebar-sub-header"><a href="/md/java/learn/å…³é”®å­—-synchronized.html#å‚è€ƒæ–‡ç« " class="sidebar-link">å‚è€ƒæ–‡ç« </a></li></ul></li><li><a href="/md/java/learn/å…³é”®å­—-volatile.html" class="sidebar-link">å…³é”®å­—-volatile</a></li><li><a href="/md/java/learn/å…³é”®å­—-final.html" class="sidebar-link">å…³é”®å­—-final</a></li><li><a href="/md/java/learn/é«˜å¹¶å‘-ThreadLocalè¯¦è§£.html" class="sidebar-link">é«˜å¹¶å‘ - ThreadLocalè¯¦è§£</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>æ¡†æ¶</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/md/java/learn/Springç¬”è®°.html" class="sidebar-link">Spring</a></li><li><a href="/md/java/learn/Spring-MVCç¬”è®°.html" class="sidebar-link">SpringMVC</a></li><li><a href="/md/java/learn/Mybatisç¬”è®°.html" class="sidebar-link">Mybatis</a></li><li><a href="/md/java/learn/MybatisPlusç¬”è®°.html" class="sidebar-link">Mybatis-Plus</a></li><li><a href="/md/java/learn/SpringBootç¬”è®°.html" class="sidebar-link">SpringBoot</a></li><li><a href="/md/java/learn/learn-zookeeper.html" class="sidebar-link">Zookeeper</a></li><li><a href="/md/java/learn/learn-redis.html" class="sidebar-link">Redis</a></li><li><a href="/md/java/learn/learn-elasticstack.html" class="sidebar-link">Elasticstack</a></li><li><a href="/md/java/learn/Dubboå­¦ä¹ ç¬”è®°.html" class="sidebar-link">Dubbo</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JVM</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/md/java/learn/JVMå¿«é€Ÿå…¥é—¨ç¯‡.html" class="sidebar-link">JVMå¿«é€Ÿå…¥é—¨ç¯‡</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="å…³é”®å­—-synchronized"><a href="#å…³é”®å­—-synchronized" class="header-anchor">#</a> å…³é”®å­—-synchronized</h1> <aside>
ğŸ’¡ åœ¨Cç¨‹åºä»£ç ä¸­æˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„äº’æ–¥é”æ¥å®ç°åŒæ­¥å—çš„äº’æ–¥è®¿é—®åŠçº¿ç¨‹çš„é˜»å¡åŠå”¤é†’ç­‰å·¥ä½œã€‚åœ¨Javaä¸­é™¤äº†æä¾›Lock APIå¤–è¿˜åœ¨è¯­æ³•å±‚é¢ä¸Šæä¾›äº†synchronizedå…³é”®å­—æ¥å®ç°äº’æ–¥åŒæ­¥åŸè¯­, æœ¬æ–‡å°†å¯¹synchronizedå…³é”®å­—è¯¦ç»†åˆ†æã€‚
</aside> <h2 id="å¸¦ç€batå¤§å‚çš„é¢è¯•é—®é¢˜å»ç†è§£synchronized"><a href="#å¸¦ç€batå¤§å‚çš„é¢è¯•é—®é¢˜å»ç†è§£synchronized" class="header-anchor">#</a> å¸¦ç€BATå¤§å‚çš„é¢è¯•é—®é¢˜å»ç†è§£Synchronized</h2> <p>è¯·å¸¦ç€è¿™äº›é—®é¢˜ç»§ç»­åæ–‡ï¼Œä¼šå¾ˆå¤§ç¨‹åº¦ä¸Šå¸®åŠ©ä½ æ›´å¥½çš„ç†è§£synchronizedã€‚</p> <ul><li>Synchronizedå¯ä»¥<strong>ä½œç”¨</strong>åœ¨å“ªé‡Œ? åˆ†åˆ«é€šè¿‡<strong>å¯¹è±¡é”</strong>å’Œ<strong>ç±»é”</strong>è¿›è¡Œä¸¾ä¾‹ã€‚</li> <li>Synchronizedæœ¬è´¨ä¸Šæ˜¯<strong>é€šè¿‡ä»€ä¹ˆä¿è¯çº¿ç¨‹å®‰å…¨</strong>çš„? åˆ†ä¸‰ä¸ªæ–¹é¢å›ç­”ï¼š<strong>åŠ é”å’Œé‡Šæ”¾é”çš„åŸç†</strong>ï¼Œ<strong>å¯é‡å…¥åŸç†</strong>ï¼Œä¿è¯<strong>å¯è§æ€§åŸç†</strong>ã€‚</li> <li>Synchronizedç”±ä»€ä¹ˆæ ·çš„<strong>ç¼ºé™·</strong>? Java <strong>Lockæ˜¯æ€ä¹ˆå¼¥è¡¥</strong>è¿™äº›ç¼ºé™·çš„ã€‚</li> <li>Synchronizedå’ŒLockçš„<strong>å¯¹æ¯”</strong>ï¼Œå’Œé€‰æ‹©?</li> <li>Synchronizedåœ¨ä½¿ç”¨æ—¶æœ‰ä½•<strong>æ³¨æ„äº‹é¡¹</strong>?</li> <li>Synchronizedä¿®é¥°çš„æ–¹æ³•åœ¨<strong>æŠ›å‡ºå¼‚å¸¸æ—¶,ä¼šé‡Šæ”¾é”å—</strong>?</li> <li>å¤šä¸ªçº¿ç¨‹ç­‰å¾…åŒä¸€ä¸ªsnchronizedé”çš„æ—¶å€™ï¼ŒJVMå¦‚ä½•<strong>é€‰æ‹©ä¸‹ä¸€ä¸ªè·å–é”çš„çº¿ç¨‹</strong>?</li> <li>Synchronizedä½¿å¾—åŒæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‰§è¡Œï¼Œæ€§èƒ½æ¯”è¾ƒå·®ï¼Œæœ‰ä»€ä¹ˆ<strong>æå‡æ€§èƒ½çš„æ–¹æ³•</strong>?</li> <li>æˆ‘<strong>æƒ³æ›´åŠ çµæ´»åœ°æ§åˆ¶é”çš„é‡Šæ”¾å’Œè·å–</strong>(ç°åœ¨é‡Šæ”¾é”å’Œè·å–é”çš„æ—¶æœºéƒ½è¢«è§„å®šæ­»äº†)ï¼Œæ€ä¹ˆåŠ?</li> <li>ä»€ä¹ˆæ˜¯<strong>é”çš„å‡çº§å’Œé™çº§</strong>? ä»€ä¹ˆæ˜¯JVMé‡Œçš„<strong>åæ–œé”ã€è½»é‡çº§é”ã€é‡é‡çº§é”</strong>?</li> <li><strong>ä¸åŒçš„JDKä¸­å¯¹Synchronizedæœ‰ä½•ä¼˜åŒ–</strong>?</li></ul> <h2 id="synchronizedçš„ä½¿ç”¨"><a href="#synchronizedçš„ä½¿ç”¨" class="header-anchor">#</a> Synchronizedçš„ä½¿ç”¨</h2> <p>åœ¨åº”ç”¨Sychronizedå…³é”®å­—æ—¶éœ€è¦æŠŠæ¡å¦‚ä¸‹æ³¨æ„ç‚¹ï¼š</p> <ul><li>ä¸€æŠŠé”åªèƒ½åŒæ—¶è¢«ä¸€ä¸ªçº¿ç¨‹è·å–ï¼Œæ²¡æœ‰è·å¾—é”çš„çº¿ç¨‹åªèƒ½ç­‰å¾…ï¼›</li> <li>æ¯ä¸ªå®ä¾‹éƒ½å¯¹åº”æœ‰è‡ªå·±çš„ä¸€æŠŠé”(this),ä¸åŒå®ä¾‹ä¹‹é—´äº’ä¸å½±å“ï¼›ä¾‹å¤–ï¼šé”å¯¹è±¡æ˜¯*.classä»¥åŠsynchronizedä¿®é¥°çš„æ˜¯staticæ–¹æ³•çš„æ—¶å€™ï¼Œæ‰€æœ‰å¯¹è±¡å…¬ç”¨åŒä¸€æŠŠé”</li> <li>synchronizedä¿®é¥°çš„æ–¹æ³•ï¼Œæ— è®ºæ–¹æ³•æ­£å¸¸æ‰§è¡Œå®Œæ¯•è¿˜æ˜¯æŠ›å‡ºå¼‚å¸¸ï¼Œéƒ½ä¼šé‡Šæ”¾é”</li></ul> <h3 id="å¯¹è±¡é”"><a href="#å¯¹è±¡é”" class="header-anchor">#</a> å¯¹è±¡é”</h3> <p>åŒ…æ‹¬æ–¹æ³•é”(é»˜è®¤é”å¯¹è±¡ä¸ºthis,å½“å‰å®ä¾‹å¯¹è±¡)å’ŒåŒæ­¥ä»£ç å—é”(è‡ªå·±æŒ‡å®šé”å¯¹è±¡)</p> <h3 id="ä»£ç å—å½¢å¼-æ‰‹åŠ¨æŒ‡å®šé”å®šå¯¹è±¡-ä¹Ÿå¯æ˜¯æ˜¯this-ä¹Ÿå¯ä»¥æ˜¯è‡ªå®šä¹‰çš„é”"><a href="#ä»£ç å—å½¢å¼-æ‰‹åŠ¨æŒ‡å®šé”å®šå¯¹è±¡-ä¹Ÿå¯æ˜¯æ˜¯this-ä¹Ÿå¯ä»¥æ˜¯è‡ªå®šä¹‰çš„é”" class="header-anchor">#</a> <strong>ä»£ç å—å½¢å¼ï¼šæ‰‹åŠ¨æŒ‡å®šé”å®šå¯¹è±¡ï¼Œä¹Ÿå¯æ˜¯æ˜¯this,ä¹Ÿå¯ä»¥æ˜¯è‡ªå®šä¹‰çš„é”</strong></h3> <ul><li>ç¤ºä¾‹1</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>public class SynchronizedObjectLock implements Runnable {
    static SynchronizedObjectLock instence = new SynchronizedObjectLock();

    @Override
    public void run() {
        // åŒæ­¥ä»£ç å—å½¢å¼â€”â€”é”ä¸ºthis,ä¸¤ä¸ªçº¿ç¨‹ä½¿ç”¨çš„é”æ˜¯ä¸€æ ·çš„,çº¿ç¨‹1å¿…é¡»è¦ç­‰åˆ°çº¿ç¨‹0é‡Šæ”¾äº†è¯¥é”åï¼Œæ‰èƒ½æ‰§è¡Œ
        synchronized (this) {
            System.out.println(&quot;æˆ‘æ˜¯çº¿ç¨‹&quot; + Thread.currentThread().getName());
            try {
                Thread.sleep(3000);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
            System.out.println(Thread.currentThread().getName() + &quot;ç»“æŸ&quot;);
        }
    }

    public static void main(String[] args) {
        Thread t1 = new Thread(instence);
        Thread t2 = new Thread(instence);
        t1.start();
        t2.start();
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>è¾“å‡ºç»“æœï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>æˆ‘æ˜¯çº¿ç¨‹Thread-0
Thread-0ç»“æŸ
æˆ‘æ˜¯çº¿ç¨‹Thread-1
Thread-1ç»“æŸ
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>ç¤ºä¾‹2</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>public class SynchronizedObjectLock implements Runnable {
    static SynchronizedObjectLock instence = new SynchronizedObjectLock();
    // åˆ›å»º2æŠŠé”
    Object block1 = new Object();
    Object block2 = new Object();

    @Override
    public void run() {
        // è¿™ä¸ªä»£ç å—ä½¿ç”¨çš„æ˜¯ç¬¬ä¸€æŠŠé”ï¼Œå½“ä»–é‡Šæ”¾åï¼Œåé¢çš„ä»£ç å—ç”±äºä½¿ç”¨çš„æ˜¯ç¬¬äºŒæŠŠé”ï¼Œå› æ­¤å¯ä»¥é©¬ä¸Šæ‰§è¡Œ
        synchronized (block1) {
            System.out.println(&quot;block1é”,æˆ‘æ˜¯çº¿ç¨‹&quot; + Thread.currentThread().getName());
            try {
                Thread.sleep(3000);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
            System.out.println(&quot;block1é”,&quot;+Thread.currentThread().getName() + &quot;ç»“æŸ&quot;);
        }

        synchronized (block2) {
            System.out.println(&quot;block2é”,æˆ‘æ˜¯çº¿ç¨‹&quot; + Thread.currentThread().getName());
            try {
                Thread.sleep(3000);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
            System.out.println(&quot;block2é”,&quot;+Thread.currentThread().getName() + &quot;ç»“æŸ&quot;);
        }
    }

    public static void main(String[] args) {
        Thread t1 = new Thread(instence);
        Thread t2 = new Thread(instence);
        t1.start();
        t2.start();
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p>è¾“å‡ºç»“æœï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>block1é”,æˆ‘æ˜¯çº¿ç¨‹Thread-0
block1é”,Thread-0ç»“æŸ
block2é”,æˆ‘æ˜¯çº¿ç¨‹Thread-0ã€€ã€€// å¯ä»¥çœ‹åˆ°å½“ç¬¬ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œå®Œç¬¬ä¸€æ®µåŒæ­¥ä»£ç å—ä¹‹åï¼Œç¬¬äºŒä¸ªåŒæ­¥ä»£ç å—å¯ä»¥é©¬ä¸Šå¾—åˆ°æ‰§è¡Œï¼Œå› ä¸ºä»–ä»¬ä½¿ç”¨çš„é”ä¸æ˜¯åŒä¸€æŠŠ
block1é”,æˆ‘æ˜¯çº¿ç¨‹Thread-1
block2é”,Thread-0ç»“æŸ
block1é”,Thread-1ç»“æŸ
block2é”,æˆ‘æ˜¯çº¿ç¨‹Thread-1
block2é”,Thread-1ç»“æŸ
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="æ–¹æ³•é”å½¢å¼-synchronizedä¿®é¥°æ™®é€šæ–¹æ³•-é”å¯¹è±¡é»˜è®¤ä¸ºthis"><a href="#æ–¹æ³•é”å½¢å¼-synchronizedä¿®é¥°æ™®é€šæ–¹æ³•-é”å¯¹è±¡é»˜è®¤ä¸ºthis" class="header-anchor">#</a> æ–¹æ³•é”å½¢å¼ï¼šsynchronizedä¿®é¥°æ™®é€šæ–¹æ³•ï¼Œé”å¯¹è±¡é»˜è®¤ä¸ºthis</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>public class SynchronizedObjectLock implements Runnable {
    static SynchronizedObjectLock instence = new SynchronizedObjectLock();

    @Override
    public void run() {
        method();
    }

    public synchronized void method() {
        System.out.println(&quot;æˆ‘æ˜¯çº¿ç¨‹&quot; + Thread.currentThread().getName());
        try {
            Thread.sleep(3000);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
        System.out.println(Thread.currentThread().getName() + &quot;ç»“æŸ&quot;);
    }

    public static void main(String[] args) {
        Thread t1 = new Thread(instence);
        Thread t2 = new Thread(instence);
        t1.start();
        t2.start();
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>è¾“å‡ºç»“æœï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>æˆ‘æ˜¯çº¿ç¨‹Thread-0
Thread-0ç»“æŸ
æˆ‘æ˜¯çº¿ç¨‹Thread-1
Thread-1ç»“æŸ
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="ç±»é”"><a href="#ç±»é”" class="header-anchor">#</a> ç±»é”</h3> <p>æŒ‡synchronizeä¿®é¥°é™æ€çš„æ–¹æ³•æˆ–æŒ‡å®šé”å¯¹è±¡ä¸ºClasså¯¹è±¡</p> <p><strong>synchronizeä¿®é¥°é™æ€æ–¹æ³•</strong></p> <ul><li>ç¤ºä¾‹1</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>public class SynchronizedObjectLock implements Runnable {
    static SynchronizedObjectLock instence1 = new SynchronizedObjectLock();
    static SynchronizedObjectLock instence2 = new SynchronizedObjectLock();

    @Override
    public void run() {
        method();
    }

    // synchronizedç”¨åœ¨æ™®é€šæ–¹æ³•ä¸Šï¼Œé»˜è®¤çš„é”å°±æ˜¯thisï¼Œå½“å‰å®ä¾‹
    public synchronized void method() {
        System.out.println(&quot;æˆ‘æ˜¯çº¿ç¨‹&quot; + Thread.currentThread().getName());
        try {
            Thread.sleep(3000);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
        System.out.println(Thread.currentThread().getName() + &quot;ç»“æŸ&quot;);
    }

    public static void main(String[] args) {
        // t1å’Œt2å¯¹åº”çš„thisæ˜¯ä¸¤ä¸ªä¸åŒçš„å®ä¾‹ï¼Œæ‰€ä»¥ä»£ç ä¸ä¼šä¸²è¡Œ
        Thread t1 = new Thread(instence1);
        Thread t2 = new Thread(instence2);
        t1.start();
        t2.start();
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>è¾“å‡ºç»“æœï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>æˆ‘æ˜¯çº¿ç¨‹Thread-0
æˆ‘æ˜¯çº¿ç¨‹Thread-1
Thread-1ç»“æŸ
Thread-0ç»“æŸ
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>ç¤ºä¾‹2</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>public class SynchronizedObjectLock implements Runnable {
    static SynchronizedObjectLock instence1 = new SynchronizedObjectLock();
    static SynchronizedObjectLock instence2 = new SynchronizedObjectLock();

    @Override
    public void run() {
        method();
    }

    // synchronizedç”¨åœ¨é™æ€æ–¹æ³•ä¸Šï¼Œé»˜è®¤çš„é”å°±æ˜¯å½“å‰æ‰€åœ¨çš„Classç±»ï¼Œæ‰€ä»¥æ— è®ºæ˜¯å“ªä¸ªçº¿ç¨‹è®¿é—®å®ƒï¼Œéœ€è¦çš„é”éƒ½åªæœ‰ä¸€æŠŠ
    public static synchronized void method() {
        System.out.println(&quot;æˆ‘æ˜¯çº¿ç¨‹&quot; + Thread.currentThread().getName());
        try {
            Thread.sleep(3000);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
        System.out.println(Thread.currentThread().getName() + &quot;ç»“æŸ&quot;);
    }

    public static void main(String[] args) {
        Thread t1 = new Thread(instence1);
        Thread t2 = new Thread(instence2);
        t1.start();
        t2.start();
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>è¾“å‡ºç»“æœï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>æˆ‘æ˜¯çº¿ç¨‹Thread-0
Thread-0ç»“æŸ
æˆ‘æ˜¯çº¿ç¨‹Thread-1
Thread-1ç»“æŸ
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>synchronizedæŒ‡å®šé”å¯¹è±¡ä¸ºClasså¯¹è±¡</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public class SynchronizedObjectLock implements Runnable {
    static SynchronizedObjectLock instence1 = new SynchronizedObjectLock();
    static SynchronizedObjectLock instence2 = new SynchronizedObjectLock();

    @Override
    public void run() {
        // æ‰€æœ‰çº¿ç¨‹éœ€è¦çš„é”éƒ½æ˜¯åŒä¸€æŠŠ
        synchronized(SynchronizedObjectLock.class){
            System.out.println(&quot;æˆ‘æ˜¯çº¿ç¨‹&quot; + Thread.currentThread().getName());
            try {
                Thread.sleep(3000);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
            System.out.println(Thread.currentThread().getName() + &quot;ç»“æŸ&quot;);
        }
    }

    public static void main(String[] args) {
        Thread t1 = new Thread(instence1);
        Thread t2 = new Thread(instence2);
        t1.start();
        t2.start();
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>è¾“å‡ºç»“æœï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>æˆ‘æ˜¯çº¿ç¨‹<span class="token class-name">Thread</span><span class="token operator">-</span><span class="token number">0</span>
<span class="token class-name">Thread</span><span class="token operator">-</span><span class="token number">0</span>ç»“æŸ
æˆ‘æ˜¯çº¿ç¨‹<span class="token class-name">Thread</span><span class="token operator">-</span><span class="token number">1</span>
<span class="token class-name">Thread</span><span class="token operator">-</span><span class="token number">1</span>ç»“æŸ
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="synchronizedåŸç†åˆ†æ"><a href="#synchronizedåŸç†åˆ†æ" class="header-anchor">#</a> SynchronizedåŸç†åˆ†æ</h2> <h3 id="åŠ é”å’Œé‡Šæ”¾é”çš„åŸç†"><a href="#åŠ é”å’Œé‡Šæ”¾é”çš„åŸç†" class="header-anchor">#</a> åŠ é”å’Œé‡Šæ”¾é”çš„åŸç†</h3> <blockquote><p>ç°è±¡ã€æ—¶æœº(å†…ç½®é”this)ã€æ·±å…¥JVMçœ‹å­—èŠ‚ç (åç¼–è¯‘çœ‹monitoræŒ‡ä»¤)</p></blockquote> <p>æ·±å…¥JVMçœ‹å­—èŠ‚ç ï¼Œåˆ›å»ºå¦‚ä¸‹çš„ä»£ç ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public class SynchronizedDemo2 {

    Object object = new Object();
    public void method1() {
        synchronized (object) {

        }
        method2();
    }

    private static void method2() {

    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>ä½¿ç”¨javacå‘½ä»¤è¿›è¡Œç¼–è¯‘ç”Ÿæˆ.classæ–‡ä»¶</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&gt;javac SynchronizedDemo2.java
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>ä½¿ç”¨javapå‘½ä»¤åç¼–è¯‘æŸ¥çœ‹.classæ–‡ä»¶çš„ä¿¡æ¯</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&gt;javap -verbose SynchronizedDemo2.class
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>å¾—åˆ°å¦‚ä¸‹çš„ä¿¡æ¯ï¼š</p> <p><img src="/assets/img/Untitled.fb026cc5.png" alt="Untitled"></p> <p>å…³æ³¨çº¢è‰²æ–¹æ¡†é‡Œçš„<code>monitorenter</code>å’Œ<code>monitorexit</code>å³å¯ã€‚</p> <p><code>Monitorenter</code>å’Œ<code>Monitorexit</code>æŒ‡ä»¤ï¼Œä¼šè®©å¯¹è±¡åœ¨æ‰§è¡Œï¼Œä½¿å…¶é”è®¡æ•°å™¨åŠ 1æˆ–è€…å‡1ã€‚æ¯ä¸€ä¸ªå¯¹è±¡åœ¨åŒä¸€æ—¶é—´åªä¸ä¸€ä¸ªmonitor(é”)ç›¸å…³è”ï¼Œè€Œä¸€ä¸ªmonitoråœ¨åŒä¸€æ—¶é—´åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹è·å¾—ï¼Œä¸€ä¸ªå¯¹è±¡åœ¨å°è¯•è·å¾—ä¸è¿™ä¸ªå¯¹è±¡ç›¸å…³è”çš„Monitoré”çš„æ‰€æœ‰æƒçš„æ—¶å€™ï¼ŒmonitorenteræŒ‡ä»¤ä¼šå‘ç”Ÿå¦‚ä¸‹3ä¸­æƒ…å†µä¹‹ä¸€ï¼š</p> <ul><li>monitorè®¡æ•°å™¨ä¸º0ï¼Œæ„å‘³ç€ç›®å‰è¿˜æ²¡æœ‰è¢«è·å¾—ï¼Œé‚£è¿™ä¸ªçº¿ç¨‹å°±ä¼šç«‹åˆ»è·å¾—ç„¶åæŠŠé”è®¡æ•°å™¨+1ï¼Œä¸€æ—¦+1ï¼Œåˆ«çš„çº¿ç¨‹å†æƒ³è·å–ï¼Œå°±éœ€è¦ç­‰å¾…</li> <li>å¦‚æœè¿™ä¸ªmonitorå·²ç»æ‹¿åˆ°äº†è¿™ä¸ªé”çš„æ‰€æœ‰æƒï¼Œåˆé‡å…¥äº†è¿™æŠŠé”ï¼Œé‚£é”è®¡æ•°å™¨å°±ä¼šç´¯åŠ ï¼Œå˜æˆ2ï¼Œå¹¶ä¸”éšç€é‡å…¥çš„æ¬¡æ•°ï¼Œä¼šä¸€ç›´ç´¯åŠ </li> <li>è¿™æŠŠé”å·²ç»è¢«åˆ«çš„çº¿ç¨‹è·å–äº†ï¼Œç­‰å¾…é”é‡Šæ”¾</li></ul> <p><code>monitorexitæŒ‡ä»¤</code>ï¼šé‡Šæ”¾å¯¹äºmonitorçš„æ‰€æœ‰æƒï¼Œé‡Šæ”¾è¿‡ç¨‹å¾ˆç®€å•ï¼Œå°±æ˜¯è®²monitorçš„è®¡æ•°å™¨å‡1ï¼Œå¦‚æœå‡å®Œä»¥åï¼Œè®¡æ•°å™¨ä¸æ˜¯0ï¼Œåˆ™ä»£è¡¨åˆšæ‰æ˜¯é‡å…¥è¿›æ¥çš„ï¼Œå½“å‰çº¿ç¨‹è¿˜ç»§ç»­æŒæœ‰è¿™æŠŠé”çš„æ‰€æœ‰æƒï¼Œå¦‚æœè®¡æ•°å™¨å˜æˆ0ï¼Œåˆ™ä»£è¡¨å½“å‰çº¿ç¨‹ä¸å†æ‹¥æœ‰è¯¥monitorçš„æ‰€æœ‰æƒï¼Œå³é‡Šæ”¾é”ã€‚</p> <p>ä¸‹å›¾è¡¨ç°äº†å¯¹è±¡ï¼Œå¯¹è±¡ç›‘è§†å™¨ï¼ŒåŒæ­¥é˜Ÿåˆ—ä»¥åŠæ‰§è¡Œçº¿ç¨‹çŠ¶æ€ä¹‹é—´çš„å…³ç³»ï¼š</p> <p><img src="/assets/img/Untitled1.03c87c18.png" alt="Untitled"></p> <p>è¯¥å›¾å¯ä»¥çœ‹å‡ºï¼Œä»»æ„çº¿ç¨‹å¯¹Objectçš„è®¿é—®ï¼Œé¦–å…ˆè¦è·å¾—Objectçš„ç›‘è§†å™¨ï¼Œå¦‚æœè·å–å¤±è´¥ï¼Œè¯¥çº¿ç¨‹å°±è¿›å…¥åŒæ­¥çŠ¶æ€ï¼Œçº¿ç¨‹çŠ¶æ€å˜ä¸ºBLOCKEDï¼Œå½“Objectçš„ç›‘è§†å™¨å æœ‰è€…é‡Šæ”¾åï¼Œåœ¨åŒæ­¥é˜Ÿåˆ—ä¸­å¾—çº¿ç¨‹å°±ä¼šæœ‰æœºä¼šé‡æ–°è·å–è¯¥ç›‘è§†å™¨ã€‚</p> <h3 id="å¯é‡å…¥åŸç†-åŠ é”æ¬¡æ•°è®¡æ•°å™¨"><a href="#å¯é‡å…¥åŸç†-åŠ é”æ¬¡æ•°è®¡æ•°å™¨" class="header-anchor">#</a> <strong>å¯é‡å…¥åŸç†ï¼šåŠ é”æ¬¡æ•°è®¡æ•°å™¨</strong></h3> <p>ä¸Šé¢çš„demoä¸­åœ¨æ‰§è¡Œå®ŒåŒæ­¥ä»£ç å—<code>method1</code>ä¹‹åç´§æ¥ç€å†ä¼šå»æ‰§è¡Œä¸€ä¸ªé™æ€åŒæ­¥æ–¹æ³•<code>method2</code>ï¼Œè€Œè¿™ä¸ªæ–¹æ³•é”çš„å¯¹è±¡ä¾ç„¶å°±è¿™ä¸ªç±»å¯¹è±¡ï¼Œé‚£ä¹ˆè¿™ä¸ªæ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹è¿˜éœ€è¦è·å–è¯¥é”å—? ç­”æ¡ˆæ˜¯ä¸å¿…çš„ï¼Œä»ä¸Šå›¾ä¸­å°±å¯ä»¥çœ‹å‡ºæ¥ï¼Œæ‰§è¡Œé™æ€åŒæ­¥æ–¹æ³•çš„æ—¶å€™å°±åªæœ‰ä¸€æ¡monitorexitæŒ‡ä»¤ï¼Œå¹¶æ²¡æœ‰monitorenterè·å–é”çš„æŒ‡ä»¤ã€‚è¿™å°±æ˜¯é”çš„é‡å…¥æ€§ï¼Œå³åœ¨åŒä¸€é”ç¨‹ä¸­ï¼Œçº¿ç¨‹ä¸éœ€è¦å†æ¬¡è·å–åŒä¸€æŠŠé”ã€‚</p> <p>Synchronizedå…ˆå¤©å…·æœ‰é‡å…¥æ€§ã€‚æ¯ä¸ªå¯¹è±¡æ‹¥æœ‰ä¸€ä¸ªè®¡æ•°å™¨ï¼Œå½“çº¿ç¨‹è·å–è¯¥å¯¹è±¡é”åï¼Œè®¡æ•°å™¨å°±ä¼šåŠ ä¸€ï¼Œé‡Šæ”¾é”åå°±ä¼šå°†è®¡æ•°å™¨å‡ä¸€ã€‚</p> <h3 id="ä¿è¯å¯è§æ€§çš„åŸç†-å†…å­˜æ¨¡å‹å’Œhappens-beforeè§„åˆ™"><a href="#ä¿è¯å¯è§æ€§çš„åŸç†-å†…å­˜æ¨¡å‹å’Œhappens-beforeè§„åˆ™" class="header-anchor">#</a> ä¿è¯å¯è§æ€§çš„åŸç†ï¼šå†…å­˜æ¨¡å‹å’Œhappens-beforeè§„åˆ™</h3> <p>Synchronizedçš„<code>happens-before</code>è§„åˆ™ï¼Œå³ç›‘è§†å™¨é”è§„åˆ™ï¼šå¯¹åŒä¸€ä¸ªç›‘è§†å™¨çš„<strong>è§£é”</strong>ï¼Œ<code>happens-before</code><strong>äº</strong>å¯¹è¯¥ç›‘è§†å™¨çš„<strong>åŠ é”</strong>ã€‚ç»§ç»­æ¥çœ‹ä»£ç ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MonitorDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">writer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token comment">// 1</span>
        a<span class="token operator">++</span><span class="token punctuation">;</span>                                <span class="token comment">// 2</span>
    <span class="token punctuation">}</span>                                       <span class="token comment">// 3</span>

    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">reader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 4</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> a<span class="token punctuation">;</span>                         <span class="token comment">// 5</span>
    <span class="token punctuation">}</span>                                      <span class="token comment">// 6</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>è¯¥ä»£ç çš„happens-beforeå…³ç³»å¦‚å›¾æ‰€ç¤ºï¼š</p> <p><img src="/assets/img/Untitled2.6363ea8d.png" alt="Untitled"></p> <p>åœ¨å›¾ä¸­æ¯ä¸€ä¸ªç®­å¤´è¿æ¥çš„<strong>ä¸¤ä¸ªèŠ‚ç‚¹å°±ä»£è¡¨ä¹‹é—´çš„happens-beforeå…³ç³»</strong>ï¼Œ<strong>é»‘è‰²çš„æ˜¯é€šè¿‡ç¨‹åºé¡ºåºè§„åˆ™æ¨å¯¼å‡ºæ¥</strong>ï¼Œ<strong>çº¢è‰²çš„ä¸ºç›‘è§†å™¨é”è§„åˆ™æ¨å¯¼è€Œå‡º</strong>ï¼š<strong>çº¿ç¨‹Aé‡Šæ”¾é”(è§£é”)happens-beforeçº¿ç¨‹BåŠ é”</strong>ï¼Œè“è‰²çš„åˆ™æ˜¯é€šè¿‡ç¨‹åºé¡ºåºè§„åˆ™å’Œç›‘è§†å™¨é”è§„åˆ™æ¨æµ‹å‡ºæ¥happens-beforeå…³ç³»ï¼Œé€šè¿‡ä¼ é€’æ€§è§„åˆ™è¿›ä¸€æ­¥æ¨å¯¼çš„happens-beforeå…³ç³»ã€‚ç°åœ¨æˆ‘ä»¬æ¥é‡ç‚¹å…³æ³¨2 happens-before 5ï¼Œé€šè¿‡è¿™ä¸ªå…³ç³»æˆ‘ä»¬å¯ä»¥å¾—å‡ºä»€ä¹ˆ?</p> <p>æ ¹æ®happens-beforeçš„å®šä¹‰ä¸­çš„ä¸€æ¡:<strong>å¦‚æœA happens-before Bï¼Œåˆ™Açš„æ‰§è¡Œç»“æœå¯¹Bå¯è§ï¼Œå¹¶ä¸”Açš„æ‰§è¡Œé¡ºåºå…ˆäºB</strong>ã€‚çº¿ç¨‹Aå…ˆå¯¹å…±äº«å˜é‡Aè¿›è¡ŒåŠ ä¸€ï¼Œ<strong>ç”±2 happens-before 5å…³ç³»å¯çŸ¥çº¿ç¨‹Açš„æ‰§è¡Œç»“æœå¯¹çº¿ç¨‹Bå¯è§å³çº¿ç¨‹Bæ‰€è¯»å–åˆ°çš„açš„å€¼ä¸º1</strong>ã€‚</p> <h2 id="jvmä¸­é”çš„ä¼˜åŒ–"><a href="#jvmä¸­é”çš„ä¼˜åŒ–" class="header-anchor">#</a> JVMä¸­é”çš„ä¼˜åŒ–</h2> <p>ç®€å•æ¥è¯´åœ¨JVMä¸­monitorenterå’Œmonitorexitå­—èŠ‚ç ä¾èµ–äºåº•å±‚çš„æ“ä½œç³»ç»Ÿçš„Mutex Lockæ¥å®ç°çš„ï¼Œä½†æ˜¯ç”±äºä½¿ç”¨Mutex Lockéœ€è¦å°†å½“å‰çº¿ç¨‹æŒ‚èµ·å¹¶ä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€æ¥æ‰§è¡Œï¼Œè¿™ç§åˆ‡æ¢çš„ä»£ä»·æ˜¯éå¸¸æ˜‚è´µçš„ï¼›ç„¶è€Œåœ¨ç°å®ä¸­çš„å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼ŒåŒæ­¥æ–¹æ³•æ˜¯è¿è¡Œåœ¨å•çº¿ç¨‹ç¯å¢ƒ(æ— é”ç«äº‰ç¯å¢ƒ)å¦‚æœæ¯æ¬¡éƒ½è°ƒç”¨Mutex Locké‚£ä¹ˆå°†ä¸¥é‡çš„å½±å“ç¨‹åºçš„æ€§èƒ½ã€‚<strong>ä¸è¿‡åœ¨jdk1.6ä¸­å¯¹é”çš„å®ç°å¼•å…¥äº†å¤§é‡çš„ä¼˜åŒ–ï¼Œå¦‚é”ç²—åŒ–(Lock Coarsening)ã€é”æ¶ˆé™¤(Lock Elimination)ã€è½»é‡çº§é”(Lightweight Locking)ã€åå‘é”(Biased Locking)ã€é€‚åº”æ€§è‡ªæ—‹(Adaptive Spinning)ç­‰æŠ€æœ¯æ¥å‡å°‘é”æ“ä½œçš„å¼€é”€</strong>ã€‚</p> <ul><li><code>é”ç²—åŒ–(Lock Coarsening)</code>ï¼šä¹Ÿå°±æ˜¯å‡å°‘ä¸å¿…è¦çš„ç´§è¿åœ¨ä¸€èµ·çš„unlockï¼Œlockæ“ä½œï¼Œå°†å¤šä¸ªè¿ç»­çš„é”<strong>æ‰©å±•æˆä¸€ä¸ªèŒƒå›´æ›´å¤§çš„é”</strong>ã€‚</li> <li><code>é”æ¶ˆé™¤(Lock Elimination)</code>ï¼šé€šè¿‡è¿è¡Œæ—¶JITç¼–è¯‘å™¨çš„é€ƒé€¸åˆ†ææ¥<strong>æ¶ˆé™¤ä¸€äº›æ²¡æœ‰åœ¨å½“å‰åŒæ­¥å—ä»¥å¤–è¢«å…¶ä»–çº¿ç¨‹å…±äº«çš„æ•°æ®çš„é”</strong>ä¿æŠ¤ï¼Œé€šè¿‡é€ƒé€¸åˆ†æä¹Ÿå¯ä»¥åœ¨çº¿ç¨‹æœ¬åœ°Stackä¸Šè¿›è¡Œå¯¹è±¡ç©ºé—´çš„åˆ†é…(åŒæ—¶è¿˜å¯ä»¥å‡å°‘Heapä¸Šçš„åƒåœ¾æ”¶é›†å¼€é”€)ã€‚</li> <li><code>è½»é‡çº§é”(Lightweight Locking)</code>ï¼šè¿™ç§é”å®ç°çš„èƒŒå<strong>åŸºäºè¿™æ ·ä¸€ç§å‡è®¾</strong>ï¼Œå³åœ¨çœŸå®çš„æƒ…å†µä¸‹æˆ‘ä»¬ç¨‹åºä¸­çš„<strong>å¤§éƒ¨åˆ†åŒæ­¥ä»£ç ä¸€èˆ¬éƒ½å¤„äºæ— é”ç«äº‰çŠ¶æ€</strong>(å³å•çº¿ç¨‹æ‰§è¡Œç¯å¢ƒ)ï¼Œ<strong>åœ¨æ— é”ç«äº‰çš„æƒ…å†µä¸‹å®Œå…¨å¯ä»¥é¿å…è°ƒç”¨æ“ä½œç³»ç»Ÿå±‚é¢çš„é‡é‡çº§äº’æ–¥é”</strong>ï¼Œ<strong>å–è€Œä»£ä¹‹</strong>çš„<strong>æ˜¯åœ¨monitorenterå’Œmonitorexitä¸­åªéœ€è¦ä¾é ä¸€æ¡CASåŸå­æŒ‡ä»¤å°±å¯ä»¥å®Œæˆé”çš„è·å–åŠé‡Šæ”¾</strong>ã€‚å½“<strong>å­˜åœ¨é”ç«äº‰çš„æƒ…å†µä¸‹ï¼Œæ‰§è¡ŒCASæŒ‡ä»¤å¤±è´¥çš„çº¿ç¨‹å°†è°ƒç”¨æ“ä½œç³»ç»Ÿäº’æ–¥é”</strong>è¿›å…¥åˆ°é˜»å¡çŠ¶æ€ï¼Œå½“<strong>é”è¢«é‡Šæ”¾çš„æ—¶å€™è¢«å”¤é†’</strong>(å…·ä½“å¤„ç†æ­¥éª¤ä¸‹é¢è¯¦ç»†è®¨è®º)ã€‚</li> <li><code>åå‘é”(Biased Locking)</code>ï¼šæ˜¯ä¸ºäº†åœ¨æ— é”ç«äº‰çš„æƒ…å†µä¸‹<strong>é¿å…åœ¨é”è·å–è¿‡ç¨‹ä¸­æ‰§è¡Œä¸å¿…è¦çš„CASåŸå­æŒ‡ä»¤</strong>ï¼Œå› ä¸º<strong>CASåŸå­æŒ‡ä»¤</strong>è™½ç„¶ç›¸å¯¹äºé‡é‡çº§é”æ¥è¯´å¼€é”€æ¯”è¾ƒå°<strong>ä½†è¿˜æ˜¯å­˜åœ¨éå¸¸å¯è§‚çš„æœ¬åœ°å»¶è¿Ÿ</strong>ã€‚</li> <li><code>é€‚åº”æ€§è‡ªæ—‹(Adaptive Spinning)</code>ï¼šå½“çº¿ç¨‹åœ¨<strong>è·å–è½»é‡çº§é”çš„è¿‡ç¨‹ä¸­æ‰§è¡ŒCASæ“ä½œå¤±è´¥æ—¶</strong>ï¼Œåœ¨<strong>è¿›å…¥</strong>ä¸monitorç›¸å…³è”çš„<strong>æ“ä½œç³»ç»Ÿé‡é‡çº§é”</strong>(mutex semaphore)<strong>å‰ä¼šè¿›å…¥å¿™ç­‰å¾…</strong>(Spinning)ç„¶å<strong>å†æ¬¡å°è¯•</strong>ï¼Œå½“<strong>å°è¯•ä¸€å®šçš„æ¬¡æ•°åå¦‚æœä»ç„¶æ²¡æœ‰æˆåŠŸåˆ™è°ƒç”¨ä¸è¯¥monitorå…³è”çš„semaphore(å³äº’æ–¥é”)è¿›å…¥åˆ°é˜»å¡çŠ¶æ€</strong>ã€‚</li></ul> <blockquote><p>ä¸‹é¢æ¥è¯¦ç»†è®²è§£ä¸‹ï¼Œå…ˆä»SynchroniedåŒæ­¥é”å¼€å§‹è®²èµ·ï¼š</p></blockquote> <h3 id="é”çš„ç±»å‹"><a href="#é”çš„ç±»å‹" class="header-anchor">#</a> <strong>é”çš„ç±»å‹</strong></h3> <p>åœ¨Java SE 1.6é‡ŒSynchroniedåŒæ­¥é”ï¼Œä¸€å…±æœ‰å››ç§çŠ¶æ€ï¼š<code>æ— é”</code>ã€<code>åå‘é”</code>ã€<code>è½»é‡çº§æ‰€</code>ã€<code>é‡é‡çº§é”</code>ï¼Œå®ƒä¼šéšç€ç«äº‰æƒ…å†µé€æ¸å‡çº§ã€‚é”å¯ä»¥å‡çº§ä½†æ˜¯ä¸å¯ä»¥é™çº§ï¼Œç›®çš„æ˜¯ä¸ºäº†æä¾›è·å–é”å’Œé‡Šæ”¾é”çš„æ•ˆç‡ã€‚</p> <blockquote><p>é”è†¨èƒ€æ–¹å‘ï¼š æ— é” â†’ åå‘é” â†’ è½»é‡çº§é” â†’ é‡é‡çº§é” (æ­¤è¿‡ç¨‹æ˜¯ä¸å¯é€†çš„)</p></blockquote> <h3 id="è‡ªæ—‹é”ä¸è‡ªé€‚åº”è‡ªæ—‹é”"><a href="#è‡ªæ—‹é”ä¸è‡ªé€‚åº”è‡ªæ—‹é”" class="header-anchor">#</a> è‡ªæ—‹é”ä¸è‡ªé€‚åº”è‡ªæ—‹é”</h3> <p><strong>è‡ªæ—‹é”</strong></p> <blockquote><p>å¼•å…¥èƒŒæ™¯ï¼šå¤§å®¶éƒ½çŸ¥é“ï¼Œåœ¨æ²¡æœ‰åŠ å…¥é”ä¼˜åŒ–æ—¶ï¼ŒSynchronizedæ˜¯ä¸€ä¸ªéå¸¸â€œèƒ–å¤§â€çš„å®¶ä¼™ã€‚åœ¨å¤šçº¿ç¨‹ç«äº‰é”æ—¶ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è·å–é”æ—¶ï¼Œå®ƒä¼šé˜»å¡æ‰€æœ‰æ­£åœ¨ç«äº‰çš„çº¿ç¨‹ï¼Œè¿™æ ·å¯¹æ€§èƒ½å¸¦æ¥äº†æå¤§çš„å½±å“ã€‚åœ¨æŒ‚èµ·çº¿ç¨‹å’Œæ¢å¤çº¿ç¨‹çš„æ“ä½œéƒ½éœ€è¦è½¬å…¥å†…æ ¸æ€ä¸­å®Œæˆï¼Œè¿™äº›æ“ä½œå¯¹ç³»ç»Ÿçš„å¹¶å‘æ€§èƒ½å¸¦æ¥äº†å¾ˆå¤§çš„å‹åŠ›ã€‚åŒæ—¶HotSpotå›¢é˜Ÿæ³¨æ„åˆ°åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œå…±äº«æ•°æ®çš„é”å®šçŠ¶æ€åªä¼šæŒç»­å¾ˆçŸ­çš„ä¸€æ®µæ—¶é—´ï¼Œä¸ºäº†è¿™æ®µæ—¶é—´å»æŒ‚èµ·å’Œå›å¤é˜»å¡çº¿ç¨‹å¹¶ä¸å€¼å¾—ã€‚åœ¨å¦‚ä»Šå¤šå¤„ç†å™¨ç¯å¢ƒä¸‹ï¼Œå®Œå…¨å¯ä»¥è®©å¦ä¸€ä¸ªæ²¡æœ‰è·å–åˆ°é”çš„çº¿ç¨‹åœ¨é—¨å¤–ç­‰å¾…ä¸€ä¼š(è‡ªæ—‹)ï¼Œä½†ä¸æ”¾å¼ƒCPUçš„æ‰§è¡Œæ—¶é—´ã€‚ç­‰å¾…æŒæœ‰é”çš„çº¿ç¨‹æ˜¯å¦å¾ˆå¿«å°±ä¼šé‡Šæ”¾é”ã€‚ä¸ºäº†è®©çº¿ç¨‹ç­‰å¾…ï¼Œæˆ‘ä»¬åªéœ€è¦è®©çº¿ç¨‹æ‰§è¡Œä¸€ä¸ªå¿™å¾ªç¯(è‡ªæ—‹)ï¼Œè¿™ä¾¿æ˜¯è‡ªæ—‹é”ç”±æ¥çš„åŸå› ã€‚</p></blockquote> <p>è‡ªæ—‹é”æ—©åœ¨JDK1.4 ä¸­å°±å¼•å…¥äº†ï¼Œåªæ˜¯å½“æ—¶é»˜è®¤æ—¶å…³é—­çš„ã€‚åœ¨JDK 1.6åé»˜è®¤ä¸ºå¼€å¯çŠ¶æ€ã€‚è‡ªæ—‹é”æœ¬è´¨ä¸Šä¸é˜»å¡å¹¶ä¸ç›¸åŒï¼Œå…ˆä¸è€ƒè™‘å…¶å¯¹å¤šå¤„ç†å™¨çš„è¦æ±‚ï¼Œå¦‚æœé”å ç”¨çš„æ—¶é—´éå¸¸çš„çŸ­ï¼Œé‚£ä¹ˆè‡ªæ—‹é”çš„æ€§èƒ½ä¼šéå¸¸çš„å¥½ï¼Œç›¸åï¼Œå…¶ä¼šå¸¦æ¥æ›´å¤šçš„æ€§èƒ½å¼€é”€(å› ä¸ºåœ¨çº¿ç¨‹è‡ªæ—‹æ—¶ï¼Œå§‹ç»ˆä¼šå ç”¨CPUçš„æ—¶é—´ç‰‡ï¼Œå¦‚æœé”å ç”¨çš„æ—¶é—´å¤ªé•¿ï¼Œé‚£ä¹ˆè‡ªæ—‹çš„çº¿ç¨‹ä¼šç™½ç™½æ¶ˆè€—æ‰CPUèµ„æº)ã€‚å› æ­¤è‡ªæ—‹ç­‰å¾…çš„æ—¶é—´å¿…é¡»è¦æœ‰ä¸€å®šçš„é™åº¦ï¼Œå¦‚æœ<strong>è‡ªæ—‹è¶…è¿‡äº†é™å®šçš„æ¬¡æ•°ä»ç„¶æ²¡æœ‰æˆåŠŸè·å–åˆ°é”ï¼Œå°±åº”è¯¥ä½¿ç”¨ä¼ ç»Ÿçš„æ–¹å¼å»æŒ‚èµ·çº¿ç¨‹</strong>äº†ï¼Œåœ¨JDKå®šä¹‰ä¸­ï¼Œ<strong>è‡ªæ—‹é”é»˜è®¤çš„è‡ªæ—‹æ¬¡æ•°ä¸º10æ¬¡ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨å‚æ•°<code>-XX:PreBlockSpin</code>æ¥æ›´æ”¹</strong>ã€‚</p> <p>å¯æ˜¯ç°åœ¨åˆå‡ºç°äº†ä¸€ä¸ªé—®é¢˜ï¼š<strong>å¦‚æœçº¿ç¨‹é”åœ¨çº¿ç¨‹è‡ªæ—‹åˆšç»“æŸå°±é‡Šæ”¾æ‰äº†é”ï¼Œé‚£ä¹ˆæ˜¯ä¸æ˜¯æœ‰ç‚¹å¾—ä¸å¿å¤±</strong>ã€‚æ‰€ä»¥è¿™æ—¶å€™æˆ‘ä»¬<strong>éœ€è¦æ›´åŠ èªæ˜çš„é”</strong>æ¥å®ç°æ›´åŠ çµæ´»çš„è‡ªæ—‹ã€‚æ¥æé«˜å¹¶å‘çš„æ€§èƒ½ã€‚(è¿™é‡Œåˆ™éœ€è¦è‡ªé€‚åº”è‡ªæ—‹é”ï¼)</p> <p><strong>è‡ªé€‚åº”è‡ªæ—‹é”</strong></p> <p>åœ¨JDK 1.6ä¸­å¼•å…¥äº†è‡ªé€‚åº”è‡ªæ—‹é”ã€‚è¿™å°±æ„å‘³ç€è‡ªæ—‹çš„æ—¶é—´ä¸å†å›ºå®šäº†ï¼Œè€Œæ˜¯ç”±å‰ä¸€æ¬¡åœ¨åŒä¸€ä¸ªé”ä¸Šçš„è‡ªæ—‹ æ—¶é—´åŠé”çš„æ‹¥æœ‰è€…çš„çŠ¶æ€æ¥å†³å®šçš„ã€‚å¦‚æœåœ¨åŒä¸€ä¸ªé”å¯¹è±¡ä¸Šï¼Œè‡ªæ—‹ç­‰å¾…åˆšåˆšæˆåŠŸè·å–è¿‡é”ï¼Œå¹¶ä¸”æŒæœ‰é”çš„çº¿ç¨‹æ­£åœ¨è¿è¡Œä¸­ï¼Œé‚£ä¹ˆJVMä¼šè®¤ä¸ºè¯¥é”è‡ªæ—‹è·å–åˆ°é”çš„å¯èƒ½æ€§å¾ˆå¤§ï¼Œä¼šè‡ªåŠ¨å¢åŠ ç­‰å¾…æ—¶é—´ã€‚æ¯”å¦‚å¢åŠ åˆ°100æ­¤å¾ªç¯ã€‚ç›¸åï¼Œå¦‚æœå¯¹äºæŸä¸ªé”ï¼Œè‡ªæ—‹å¾ˆå°‘æˆåŠŸè·å–é”ã€‚é‚£å†ä»¥åè¦è·å–è¿™ä¸ªé”æ—¶å°†å¯èƒ½çœç•¥æ‰è‡ªæ—‹è¿‡ç¨‹ï¼Œä»¥é¿å…æµªè´¹å¤„ç†å™¨èµ„æºã€‚æœ‰äº†è‡ªé€‚åº”è‡ªæ—‹ï¼ŒJVMå¯¹ç¨‹åºçš„é”çš„çŠ¶æ€é¢„æµ‹ä¼šè¶Šæ¥è¶Šå‡†ç¡®ï¼ŒJVMä¹Ÿä¼šè¶Šæ¥è¶Šèªæ˜ã€‚</p> <h3 id="é”æ¶ˆé™¤"><a href="#é”æ¶ˆé™¤" class="header-anchor">#</a> é”æ¶ˆé™¤</h3> <p>é”æ¶ˆé™¤æ˜¯æŒ‡è™šæ‹Ÿæœºå³æ—¶ç¼–è¯‘å™¨å†è¿è¡Œæ—¶ï¼Œå¯¹ä¸€äº›ä»£ç ä¸Šè¦æ±‚åŒæ­¥ï¼Œä½†æ˜¯è¢«æ£€æµ‹åˆ°ä¸å¯èƒ½å­˜åœ¨å…±äº«æ•°æ®ç«äº‰çš„é”è¿›è¡Œæ¶ˆé™¤ã€‚é”æ¶ˆé™¤çš„ä¸»è¦åˆ¤å®šä¾æ®æ¥æºäºé€ƒé€¸åˆ†æçš„æ•°æ®æ”¯æŒã€‚æ„æ€å°±æ˜¯ï¼šJVMä¼šåˆ¤æ–­å†ä¸€æ®µç¨‹åºä¸­çš„åŒæ­¥æ˜æ˜¾ä¸ä¼šé€ƒé€¸å‡ºå»ä»è€Œè¢«å…¶ä»–çº¿ç¨‹è®¿é—®åˆ°ï¼Œé‚£JVMå°±æŠŠå®ƒä»¬å½“ä½œæ ˆä¸Šæ•°æ®å¯¹å¾…ï¼Œè®¤ä¸ºè¿™äº›æ•°æ®æ—¶çº¿ç¨‹ç‹¬æœ‰çš„ï¼Œä¸éœ€è¦åŠ åŒæ­¥ã€‚æ­¤æ—¶å°±ä¼šè¿›è¡Œé”æ¶ˆé™¤ã€‚</p> <p>å½“ç„¶åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¾ˆæ¸…æ¥šçš„çŸ¥é“é‚£äº›åœ°æ–¹æ—¶çº¿ç¨‹ç‹¬æœ‰çš„ï¼Œä¸éœ€è¦åŠ åŒæ­¥é”ï¼Œä½†æ˜¯åœ¨Java APIä¸­æœ‰å¾ˆå¤šæ–¹æ³•éƒ½æ˜¯åŠ äº†åŒæ­¥çš„ï¼Œé‚£ä¹ˆæ­¤æ—¶JVMä¼šåˆ¤æ–­è¿™æ®µä»£ç æ˜¯å¦éœ€è¦åŠ é”ã€‚å¦‚æœæ•°æ®å¹¶ä¸ä¼šé€ƒé€¸ï¼Œåˆ™ä¼šè¿›è¡Œé”æ¶ˆé™¤ã€‚æ¯”å¦‚å¦‚ä¸‹æ“ä½œï¼šåœ¨æ“ä½œStringç±»å‹æ•°æ®æ—¶ï¼Œç”±äºStringæ˜¯ä¸€ä¸ªä¸å¯å˜ç±»ï¼Œå¯¹å­—ç¬¦ä¸²çš„è¿æ¥æ“ä½œæ€»æ˜¯é€šè¿‡ç”Ÿæˆçš„æ–°çš„Stringå¯¹è±¡æ¥è¿›è¡Œçš„ã€‚å› æ­¤Javacç¼–è¯‘å™¨ä¼šå¯¹Stringè¿æ¥åšè‡ªåŠ¨ä¼˜åŒ–ã€‚åœ¨JDK 1.5ä¹‹å‰ä¼šä½¿ç”¨StringBufferå¯¹è±¡çš„è¿ç»­append()æ“ä½œï¼Œåœ¨JDK 1.5åŠä»¥åçš„ç‰ˆæœ¬ä¸­ï¼Œä¼šè½¬åŒ–ä¸ºStringBuidlerå¯¹è±¡çš„è¿ç»­append()æ“ä½œã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">test03</span><span class="token punctuation">(</span><span class="token class-name">String</span> s1<span class="token punctuation">,</span> <span class="token class-name">String</span> s2<span class="token punctuation">,</span> <span class="token class-name">String</span> s3<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> s <span class="token operator">=</span> s1 <span class="token operator">+</span> s2 <span class="token operator">+</span> s3<span class="token punctuation">;</span>
    <span class="token keyword">return</span> s<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ä¸Šè¿°ä»£ç ä½¿ç”¨javapç¼–è¯‘ç»“æœï¼š</p> <p><img src="/assets/img/Untitled3.d3f35838.png" alt="Untitled"></p> <p>ä¼—æ‰€å‘¨çŸ¥ï¼ŒStringBuilderä¸æ˜¯å®‰å…¨åŒæ­¥çš„ï¼Œä½†æ˜¯åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼ŒJVMåˆ¤æ–­è¯¥æ®µä»£ç å¹¶ä¸ä¼šé€ƒé€¸ï¼Œåˆ™å°†è¯¥ä»£ç å¸¦é»˜è®¤ä¸ºçº¿ç¨‹ç‹¬æœ‰çš„èµ„æºï¼Œå¹¶ä¸éœ€è¦åŒæ­¥ï¼Œæ‰€ä»¥æ‰§è¡Œäº†é”æ¶ˆé™¤æ“ä½œã€‚(è¿˜æœ‰Vectorä¸­çš„å„ç§æ“ä½œä¹Ÿå¯å®ç°é”æ¶ˆé™¤ã€‚åœ¨æ²¡æœ‰é€ƒé€¸å‡ºæ•°æ®å®‰å…¨é˜²å«å†…)</p> <h3 id="é”ç²—åŒ–"><a href="#é”ç²—åŒ–" class="header-anchor">#</a> é”ç²—åŒ–</h3> <p>åŸåˆ™ä¸Šï¼Œæˆ‘ä»¬éƒ½çŸ¥é“<strong>åœ¨åŠ åŒæ­¥é”æ—¶ï¼Œå°½å¯èƒ½çš„å°†åŒæ­¥å—çš„ä½œç”¨èŒƒå›´é™åˆ¶åˆ°å°½é‡å°çš„èŒƒå›´</strong>(åª<strong>åœ¨å…±äº«æ•°æ®çš„å®é™…ä½œç”¨åŸŸä¸­æ‰è¿›è¡ŒåŒæ­¥</strong>ï¼Œè¿™æ ·æ˜¯ä¸ºäº†<strong>ä½¿å¾—éœ€è¦åŒæ­¥çš„æ“ä½œæ•°é‡å°½å¯èƒ½å˜å°</strong>ã€‚åœ¨å­˜åœ¨é”åŒæ­¥ç«äº‰ä¸­ï¼Œä¹Ÿå¯ä»¥<strong>ä½¿å¾—ç­‰å¾…é”çš„çº¿ç¨‹å°½æ—©çš„æ‹¿åˆ°é”</strong>)ã€‚</p> <p>å¤§éƒ¨åˆ†ä¸Šè¿°æƒ…å†µæ˜¯å®Œç¾æ­£ç¡®çš„ï¼Œä½†æ˜¯<strong>å¦‚æœå­˜åœ¨è¿ä¸²çš„ä¸€ç³»åˆ—æ“ä½œéƒ½å¯¹åŒä¸€ä¸ªå¯¹è±¡åå¤åŠ é”å’Œè§£é”</strong>ï¼Œ<strong>ç”šè‡³åŠ é”æ“ä½œæ—¶å‡ºç°åœ¨å¾ªç¯ä½“ä¸­çš„</strong>ï¼Œé‚£å³ä½¿æ²¡æœ‰çº¿ç¨‹ç«äº‰ï¼Œé¢‘ç¹åœ°è¿›è¡Œäº’æ–¥åŒæ­¥æ“ä½œä¹Ÿä¼šå¯¼è‡´ä¸å¿…è¦åœ°æ€§èƒ½æ“ä½œã€‚</p> <p>è¿™é‡Œè´´ä¸Šæ ¹æ®ä¸Šè¿°Javap ç¼–è¯‘åœ°æƒ…å†µç¼–å†™åœ°å®ä¾‹javaç±»</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public static String test04(String s1, String s2, String s3) {
    StringBuilder sb = new StringBuilder();
    sb.append(s1);
    sb.append(s2);
    sb.append(s3);
    return sb.toString();
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>åœ¨ä¸Šè¿°åœ°<strong>è¿ç»­append()æ“ä½œä¸­å°±å±äºè¿™ç±»æƒ…å†µ</strong>ã€‚JVMä¼šæ£€æµ‹åˆ°è¿™æ ·ä¸€è¿ä¸²åœ°æ“ä½œéƒ½æ˜¯å¯¹åŒä¸€ä¸ªå¯¹è±¡åŠ é”ï¼Œé‚£ä¹ˆ<strong>JVMä¼šå°†åŠ é”åŒæ­¥åœ°èŒƒå›´æ‰©å±•(ç²—åŒ–)åˆ°æ•´ä¸ªä¸€ç³»åˆ—æ“ä½œçš„å¤–éƒ¨</strong>ï¼Œä½¿æ•´ä¸ªä¸€è¿ä¸²åœ°append()æ“ä½œ<strong>åªéœ€è¦åŠ é”ä¸€æ¬¡</strong>å°±å¯ä»¥äº†ã€‚</p> <h3 id="è½»é‡çº§é”"><a href="#è½»é‡çº§é”" class="header-anchor">#</a> è½»é‡çº§é”</h3> <p>åœ¨JDK 1.6ä¹‹åå¼•å…¥çš„è½»é‡çº§é”ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è½»é‡çº§é”å¹¶ä¸æ˜¯æ›¿ä»£é‡é‡çº§é”çš„ï¼Œè€Œæ˜¯å¯¹åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹åŒæ­¥å—å¹¶ä¸ä¼šæœ‰ç«äº‰å‡ºç°æå‡ºçš„ä¸€ç§ä¼˜åŒ–ã€‚å®ƒå¯ä»¥å‡å°‘é‡é‡çº§é”å¯¹çº¿ç¨‹çš„é˜»å¡å¸¦æ¥åœ°çº¿ç¨‹å¼€é”€ã€‚ä»è€Œæé«˜å¹¶å‘æ€§èƒ½ã€‚</p> <p>å¦‚æœè¦ç†è§£è½»é‡çº§é”ï¼Œé‚£ä¹ˆå¿…é¡»å…ˆè¦äº†è§£HotSpotè™šæ‹Ÿæœºä¸­å¯¹è±¡å¤´åœ°å†…å­˜å¸ƒå±€ã€‚ä¸Šé¢ä»‹ç»Javaå¯¹è±¡å¤´ä¹Ÿè¯¦ç»†ä»‹ç»è¿‡ã€‚åœ¨å¯¹è±¡å¤´ä¸­(<code>Object Header</code>)å­˜åœ¨ä¸¤éƒ¨åˆ†ã€‚ç¬¬ä¸€éƒ¨åˆ†ç”¨äºå­˜å‚¨å¯¹è±¡è‡ªèº«çš„è¿è¡Œæ—¶æ•°æ®ï¼Œ<code>HashCode</code>ã€<code>GC Age</code>ã€<code>é”æ ‡è®°ä½</code>ã€<code>æ˜¯å¦ä¸ºåå‘é”</code>ã€‚ç­‰ã€‚ä¸€èˆ¬ä¸º32ä½æˆ–è€…64ä½(è§†æ“ä½œç³»ç»Ÿä½æ•°å®š)ã€‚å®˜æ–¹ç§°ä¹‹ä¸º<code>Mark Word</code>ï¼Œå®ƒæ˜¯å®ç°è½»é‡çº§é”å’Œåå‘é”çš„å…³é”®ã€‚ å¦å¤–ä¸€éƒ¨åˆ†å­˜å‚¨çš„æ˜¯æŒ‡å‘æ–¹æ³•åŒºå¯¹è±¡ç±»å‹æ•°æ®çš„æŒ‡é’ˆ(<code>Klass Point</code>)ï¼Œå¦‚æœå¯¹è±¡æ˜¯æ•°ç»„çš„è¯ï¼Œè¿˜ä¼šæœ‰ä¸€ä¸ªé¢å¤–çš„éƒ¨åˆ†ç”¨äºå­˜å‚¨æ•°æ®çš„é•¿åº¦ã€‚</p> <p><strong>è½»é‡çº§é”åŠ é”</strong></p> <p>åœ¨çº¿ç¨‹æ‰§è¡ŒåŒæ­¥å—ä¹‹å‰ï¼ŒJVMä¼šå…ˆåœ¨å½“å‰çº¿ç¨‹çš„æ ˆå¸§ä¸­åˆ›å»ºä¸€ä¸ªåä¸ºé”è®°å½•(<code>Lock Record</code>)çš„ç©ºé—´ï¼Œç”¨äºå­˜å‚¨é”å¯¹è±¡ç›®å‰çš„<code>Mark Word</code>çš„æ‹·è´ï¼ˆJVMä¼šå°†å¯¹è±¡å¤´ä¸­çš„<code>Mark Word</code>æ‹·è´åˆ°é”è®°å½•ä¸­ï¼Œå®˜æ–¹ç§°ä¸º<code>Displaced Mark Ward</code>ï¼‰ï¼Œè¿™ä¸ªæ—¶å€™çº¿ç¨‹å †æ ˆä¸å¯¹è±¡å¤´çš„çŠ¶æ€å¦‚å›¾ï¼š</p> <p><img src="/assets/img/Untitled4.8b6a0b98.png" alt="Untitled"></p> <p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼šå¦‚æœå½“å‰å¯¹è±¡<strong>æ²¡æœ‰è¢«é”å®š</strong>ï¼Œé‚£ä¹ˆé”æ ‡å¿—ä½ä½<strong>01</strong>çŠ¶æ€ï¼ŒJVMåœ¨æ‰§è¡Œå½“å‰çº¿ç¨‹æ—¶ï¼Œé¦–å…ˆä¼šåœ¨å½“å‰çº¿ç¨‹æ ˆå¸§ä¸­<strong>åˆ›å»ºé”è®°å½•<code>Lock Record</code>çš„ç©ºé—´ç”¨äºå­˜å‚¨é”å¯¹è±¡ç›®å‰çš„<code>Mark Word</code>çš„æ‹·è´</strong>ã€‚</p> <p>ç„¶åï¼Œè™šæ‹Ÿæœº<strong>ä½¿ç”¨CASæ“ä½œå°†æ ‡è®°å­—æ®µMark Wordæ‹·è´åˆ°é”è®°å½•ä¸­</strong>ï¼Œå¹¶ä¸”<strong>å°†<code>Mark Word</code>æ›´æ–°ä¸ºæŒ‡å‘<code>Lock Record</code>çš„æŒ‡é’ˆ</strong>ã€‚å¦‚æœæ›´æ–°<strong>æˆåŠŸäº†</strong>ï¼Œé‚£ä¹ˆè¿™ä¸ª<strong>çº¿ç¨‹å°±æœ‰ç”¨äº†è¯¥å¯¹è±¡çš„é”</strong>ï¼Œå¹¶ä¸”å¯¹è±¡<strong>Mark Wordçš„é”æ ‡å¿—ä½æ›´æ–°ä¸º</strong>(<code>Mark Word</code>ä¸­æœ€åçš„2bit) <strong>00</strong>ï¼Œå³<strong>è¡¨ç¤ºæ­¤å¯¹è±¡å¤„äºè½»é‡çº§é”å®šçŠ¶æ€</strong>ï¼Œå¦‚å›¾ï¼š</p> <p><img src="/assets/img/Untitled5.090547be.png" alt="Untitled"></p> <p>å¦‚æœè¿™ä¸ªæ›´æ–°æ“ä½œå¤±è´¥ï¼ŒJVMä¼šæ£€æŸ¥å½“å‰çš„<code>**Mark Word</code>ä¸­æ˜¯å¦å­˜åœ¨æŒ‡å‘å½“å‰çº¿ç¨‹çš„æ ˆå¸§çš„æŒ‡é’ˆï¼Œå¦‚æœæœ‰ï¼Œè¯´æ˜è¯¥é”å·²ç»è¢«è·å–**ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨ã€‚å¦‚æœ<strong>æ²¡æœ‰ï¼Œåˆ™è¯´æ˜è¯¥é”è¢«å…¶ä»–çº¿ç¨‹æŠ¢å </strong>äº†ï¼Œå¦‚æœæœ‰<strong>ä¸¤æ¡ä»¥ä¸Šçš„çº¿ç¨‹ç«äº‰åŒä¸€ä¸ªé”ï¼Œé‚£è½»é‡çº§é”å°±ä¸å†æœ‰æ•ˆï¼Œç›´æ¥è†¨èƒ€ä¸ºé‡é‡çº§é”</strong>ï¼Œæ²¡æœ‰è·å¾—é”çš„çº¿ç¨‹ä¼šè¢«é˜»å¡ã€‚æ­¤æ—¶ï¼Œé”çš„æ ‡å¿—ä½ä¸º<code>10</code>ï¼Œ<code>Mark Word</code>ä¸­å­˜å‚¨çš„æ˜¯æŒ‡å‘é‡é‡çº§é”çš„æŒ‡é’ˆã€‚</p> <p>è½»é‡çº§<strong>è§£é”æ—¶</strong>ï¼Œä¼š<strong>ä½¿ç”¨åŸå­çš„CASæ“ä½œå°†<code>Displaced Mark Word</code>æ›¿æ¢å›åˆ°å¯¹è±¡å¤´</strong>ä¸­ï¼Œå¦‚æœ<strong>æˆåŠŸï¼Œåˆ™è¡¨ç¤ºæ²¡æœ‰å‘ç”Ÿç«äº‰å…³ç³»</strong>ã€‚å¦‚æœ<strong>å¤±è´¥ï¼Œè¡¨ç¤ºå½“å‰é”å­˜åœ¨ç«äº‰å…³ç³»</strong>ã€‚é”å°±ä¼š<strong>è†¨èƒ€æˆé‡é‡çº§é”</strong>ã€‚ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶äº‰å¤ºé”ï¼Œå¯¼è‡´é”è†¨èƒ€çš„æµç¨‹å›¾å¦‚ä¸‹ï¼š</p> <p><img src="/assets/img/Untitled6.219a7767.png" alt="Untitled"></p> <h3 id="åå‘é”"><a href="#åå‘é”" class="header-anchor">#</a> åå‘é”</h3> <blockquote><p>å¼•å…¥èƒŒæ™¯ï¼šåœ¨å¤§å¤šå®é™…ç¯å¢ƒä¸‹ï¼Œé”ä¸ä»…ä¸å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰ï¼Œè€Œä¸”æ€»æ˜¯ç”±åŒä¸€ä¸ªçº¿ç¨‹å¤šæ¬¡è·å–ï¼Œé‚£ä¹ˆåœ¨åŒä¸€ä¸ªçº¿ç¨‹åå¤è·å–æ‰€é‡Šæ”¾é”ä¸­ï¼Œå…¶ä¸­å¹¶è¿˜æ²¡æœ‰é”çš„ç«äº‰ï¼Œé‚£ä¹ˆè¿™æ ·çœ‹ä¸Šå»ï¼Œå¤šæ¬¡çš„è·å–é”å’Œé‡Šæ”¾é”å¸¦æ¥äº†å¾ˆå¤šä¸å¿…è¦çš„æ€§èƒ½å¼€é”€å’Œä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚</p></blockquote> <p>ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼ŒHotSpotçš„ä½œè€…åœ¨Java SE 1.6 ä¸­å¯¹Synchronizedè¿›è¡Œäº†ä¼˜åŒ–ï¼Œå¼•å…¥äº†åå‘é”ã€‚å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥å¿«å¹¶è·å–é”æ—¶ï¼Œä¼šåœ¨å¯¹è±¡å¤´å’Œæ ˆå¸§ä¸­çš„é”è®°å½•é‡Œå­˜å‚¨é”åå‘çš„çº¿ç¨‹IDï¼Œä»¥åè¯¥çº¿ç¨‹åœ¨è¿›å…¥å’Œæ¨å‡ºåŒæ­¥å—æ—¶ä¸éœ€è¦è¿›è¡ŒCASæ“ä½œæ¥åŠ é”å’Œè§£é”ã€‚åªéœ€è¦ç®€å•åœ°æµ‹è¯•ä¸€ä¸‹å¯¹è±¡å¤´çš„<code>Mark Word</code>é‡Œæ˜¯å¦å­˜å‚¨ç€æŒ‡å‘å½“å‰çº¿ç¨‹çš„åå‘é”ã€‚å¦‚æœæˆåŠŸï¼Œè¡¨ç¤ºçº¿ç¨‹å·²ç»è·å–åˆ°äº†é”ã€‚</p> <p><img src="/assets/img/Untitled7.b88b9970.png" alt="Untitled"></p> <p><strong>åå‘é”çš„æ’¤é”€</strong></p> <p>åå‘é”ä½¿ç”¨äº†ä¸€ç§ç­‰å¾…ç«äº‰å‡ºç°æ‰ä¼šé‡Šæ”¾é”çš„æœºåˆ¶ã€‚æ‰€ä»¥å½“å…¶ä»–çº¿ç¨‹å°è¯•è·å–åå‘é”æ—¶ï¼ŒæŒæœ‰åå‘é”çš„çº¿ç¨‹æ‰ä¼šé‡Šæ”¾é”ã€‚ä½†æ˜¯åå‘é”çš„æ’¤é”€éœ€è¦ç­‰åˆ°å…¨å±€å®‰å…¨ç‚¹(å°±æ˜¯å½“å‰çº¿ç¨‹æ²¡æœ‰æ­£åœ¨æ‰§è¡Œçš„å­—èŠ‚ç )ã€‚å®ƒä¼šé¦–å…ˆæš‚åœæ‹¥æœ‰åå‘é”çš„çº¿ç¨‹ï¼Œè®©ä½ åæ£€æŸ¥æŒæœ‰åå‘é”çš„çº¿ç¨‹æ˜¯å¦æ´»ç€ã€‚å¦‚æœçº¿ç¨‹ä¸å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œç›´æ¥å°†å¯¹è±¡å¤´è®¾ç½®ä¸ºæ— é”çŠ¶æ€ã€‚å¦‚æœçº¿ç¨‹æ´»ç€ï¼ŒJVMä¼šéå†æ ˆå¸§ä¸­çš„é”è®°å½•ï¼Œæ ˆå¸§ä¸­çš„é”è®°å½•å’Œå¯¹è±¡å¤´è¦ä¹ˆåå‘äºå…¶ä»–çº¿ç¨‹ï¼Œè¦ä¹ˆæ¢å¤åˆ°æ— é”çŠ¶æ€æˆ–è€…æ ‡è®°å¯¹è±¡ä¸é€‚åˆä½œä¸ºåå‘é”ã€‚</p> <p><img src="/assets/img/Untitled8.a90d148b.png" alt="Untitled"></p> <h3 id="é”çš„ä¼˜ç¼ºç‚¹å¯¹æ¯”"><a href="#é”çš„ä¼˜ç¼ºç‚¹å¯¹æ¯”" class="header-anchor">#</a> é”çš„ä¼˜ç¼ºç‚¹å¯¹æ¯”</h3> <p><a href="https://www.notion.so/fdd75b3f1c524aadbc4059e3edf9a30d" target="_blank" rel="noopener noreferrer">Untitled<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="synchronizedä¸lock"><a href="#synchronizedä¸lock" class="header-anchor">#</a> Synchronizedä¸Lock</h2> <h3 id="synchronizedçš„ç¼ºé™·"><a href="#synchronizedçš„ç¼ºé™·" class="header-anchor">#</a> synchronizedçš„ç¼ºé™·</h3> <ul><li><code>æ•ˆç‡ä½</code>ï¼šé”çš„é‡Šæ”¾æƒ…å†µå°‘ï¼Œåªæœ‰ä»£ç æ‰§è¡Œå®Œæ¯•æˆ–è€…å¼‚å¸¸ç»“æŸæ‰ä¼šé‡Šæ”¾é”ï¼›è¯•å›¾è·å–é”çš„æ—¶å€™ä¸èƒ½è®¾å®šè¶…æ—¶ï¼Œä¸èƒ½ä¸­æ–­ä¸€ä¸ªæ­£åœ¨ä½¿ç”¨é”çš„çº¿ç¨‹ï¼Œç›¸å¯¹è€Œè¨€ï¼ŒLockå¯ä»¥ä¸­æ–­å’Œè®¾ç½®è¶…æ—¶</li> <li><code>ä¸å¤Ÿçµæ´»</code>ï¼šåŠ é”å’Œé‡Šæ”¾çš„æ—¶æœºå•ä¸€ï¼Œæ¯ä¸ªé”ä»…æœ‰ä¸€ä¸ªå•ä¸€çš„æ¡ä»¶(æŸä¸ªå¯¹è±¡)ï¼Œç›¸å¯¹è€Œè¨€ï¼Œè¯»å†™é”æ›´åŠ çµæ´»</li> <li><code>æ— æ³•çŸ¥é“æ˜¯å¦æˆåŠŸè·å¾—é”</code>ï¼Œç›¸å¯¹è€Œè¨€ï¼ŒLockå¯ä»¥æ‹¿åˆ°çŠ¶æ€ï¼Œå¦‚æœæˆåŠŸè·å–é”ï¼Œ....ï¼Œå¦‚æœè·å–å¤±è´¥ï¼Œ.....</li></ul> <h3 id="lockè§£å†³ç›¸åº”é—®é¢˜"><a href="#lockè§£å†³ç›¸åº”é—®é¢˜" class="header-anchor">#</a> Lockè§£å†³ç›¸åº”é—®é¢˜</h3> <p>Lockç±»è¿™é‡Œä¸åšè¿‡å¤šè§£é‡Šï¼Œä¸»è¦çœ‹é‡Œé¢çš„4ä¸ªæ–¹æ³•:</p> <ul><li><code>lock()</code>: åŠ é”</li> <li><code>unlock()</code>: è§£é”</li> <li><code>tryLock()</code>: å°è¯•è·å–é”ï¼Œè¿”å›ä¸€ä¸ªbooleanå€¼</li> <li><code>tryLock(long,TimeUtil)</code>: å°è¯•è·å–é”ï¼Œå¯ä»¥è®¾ç½®è¶…æ—¶</li></ul> <p>Synchronizedåªæœ‰é”åªä¸ä¸€ä¸ªæ¡ä»¶(æ˜¯å¦è·å–é”)ç›¸å…³è”ï¼Œä¸çµæ´»ï¼Œåæ¥<code>Conditionä¸Lockçš„ç»“åˆ</code>è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚</p> <p><strong>å¤šçº¿ç¨‹ç«äº‰ä¸€ä¸ªé”æ—¶ï¼Œå…¶ä½™æœªå¾—åˆ°é”çš„çº¿ç¨‹åªèƒ½ä¸åœçš„å°è¯•è·å¾—é”ï¼Œè€Œä¸èƒ½ä¸­æ–­ã€‚é«˜å¹¶å‘çš„æƒ…å†µä¸‹ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™</strong>ã€‚ReentrantLockçš„lockInterruptibly()æ–¹æ³•å¯ä»¥ä¼˜å…ˆè€ƒè™‘å“åº”ä¸­æ–­ã€‚ ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…æ—¶é—´è¿‡é•¿ï¼Œå®ƒå¯ä»¥ä¸­æ–­è‡ªå·±ï¼Œç„¶åReentrantLockå“åº”è¿™ä¸ªä¸­æ–­ï¼Œä¸å†è®©è¿™ä¸ªçº¿ç¨‹ç»§ç»­ç­‰å¾…ã€‚æœ‰äº†è¿™ä¸ªæœºåˆ¶ï¼Œä½¿ç”¨ReentrantLockæ—¶å°±ä¸ä¼šåƒsynchronizedé‚£æ ·äº§ç”Ÿæ­»é”äº†ã€‚</p> <blockquote><p><code>ReentrantLock</code>ä¸ºå¸¸ç”¨ç±»ï¼Œå®ƒæ˜¯ä¸€ä¸ª<strong>å¯é‡å…¥çš„äº’æ–¥é” Lock</strong>ï¼Œå®ƒå…·æœ‰ä¸ä½¿ç”¨ synchronized æ–¹æ³•å’Œè¯­å¥æ‰€è®¿é—®çš„éšå¼ç›‘è§†å™¨é”ç›¸åŒçš„ä¸€äº›åŸºæœ¬è¡Œä¸ºå’Œè¯­ä¹‰ï¼Œä½†åŠŸèƒ½æ›´å¼ºå¤§ã€‚è¯¦ç»†åˆ†æè¯·çœ‹: <a href="https://www.pdai.tech/md/java/thread/java-thread-x-lock-ReentrantLock.html" target="_blank" rel="noopener noreferrer">JUCé”: ReentrantLockè¯¦è§£<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h2 id="å†æ·±å…¥ç†è§£"><a href="#å†æ·±å…¥ç†è§£" class="header-anchor">#</a> <strong>å†æ·±å…¥ç†è§£</strong></h2> <p>synchronizedæ˜¯é€šè¿‡è½¯ä»¶(JVM)å®ç°çš„ï¼Œç®€å•æ˜“ç”¨ï¼Œå³ä½¿åœ¨JDK5ä¹‹åæœ‰äº†Lockï¼Œä»ç„¶è¢«å¹¿æ³›åœ°ä½¿ç”¨ã€‚</p> <ul><li><strong>ä½¿ç”¨Synchronizedæœ‰å“ªäº›è¦æ³¨æ„çš„ï¼Ÿ</strong> <ul><li><strong>é”å¯¹è±¡ä¸èƒ½ä¸ºç©º</strong>ï¼Œå› ä¸ºé”çš„ä¿¡æ¯éƒ½ä¿å­˜åœ¨å¯¹è±¡å¤´é‡Œ</li> <li><strong>ä½œç”¨åŸŸä¸å®œè¿‡å¤§</strong>ï¼Œå½±å“ç¨‹åºæ‰§è¡Œçš„é€Ÿåº¦ï¼Œæ§åˆ¶èŒƒå›´è¿‡å¤§ï¼Œç¼–å†™ä»£ç ä¹Ÿå®¹æ˜“å‡ºé”™</li> <li><strong>é¿å…æ­»é”</strong></li> <li>åœ¨<strong>èƒ½é€‰æ‹©çš„æƒ…å†µä¸‹ï¼Œæ—¢ä¸è¦ç”¨Lockä¹Ÿä¸è¦ç”¨synchronizedå…³é”®å­—ï¼Œç”¨java.util.concurrentåŒ…ä¸­çš„å„ç§å„æ ·çš„ç±»</strong>ï¼Œå¦‚æœä¸ç”¨è¯¥åŒ…ä¸‹çš„ç±»ï¼Œåœ¨æ»¡è¶³ä¸šåŠ¡çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨synchronizedå…³é”®ï¼Œå› ä¸ºä»£ç é‡å°‘ï¼Œé¿å…å‡ºé”™</li></ul></li> <li><strong>synchronizedæ˜¯å…¬å¹³é”å—ï¼Ÿ</strong></li></ul> <p>synchronizedå®é™…ä¸Šæ˜¯<strong>éå…¬å¹³çš„</strong>ï¼Œæ–°æ¥çš„çº¿ç¨‹æœ‰å¯èƒ½ç«‹å³è·å¾—ç›‘è§†å™¨ï¼Œè€Œåœ¨ç­‰å¾…åŒºä¸­ç­‰å€™å·²ä¹…çš„çº¿ç¨‹å¯èƒ½å†æ¬¡ç­‰å¾…ï¼Œè¿™æ ·æœ‰åˆ©äºæé«˜æ€§èƒ½ï¼Œä½†æ˜¯ä¹Ÿå¯èƒ½ä¼šå¯¼è‡´é¥¥é¥¿ç°è±¡ã€‚</p> <h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="header-anchor">#</a> å‚è€ƒæ–‡ç« </h2> <p>+ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹
+ã€ŠJavaå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹</p> <ul><li>https://juejin.im/post/5ae6dc04f265da0ba351d3ff</li> <li>https://www.cnblogs.com/javaminer/p/3889023.html</li> <li>https://www.jianshu.com/p/dab7745c0954</li> <li>https://www.cnblogs.com/wuchaodzxx/p/6867546.html</li> <li>https://www.cnblogs.com/xyabk/p/10901291.html</li> <li>https://www.jianshu.com/p/64240319ed60</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°:</span> <span class="time">2022/1/16 ä¸‹åˆ5:40:28</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/md/java/learn/é«˜å¹¶å‘-ç†è®ºåŸºç¡€.html" class="prev">
        é«˜å¹¶å‘-ç†è®ºåŸºç¡€
      </a></span> <span class="next"><a href="/md/java/learn/å…³é”®å­—-volatile.html">
        å…³é”®å­—-volatile
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.27f0b381.js" defer></script><script src="/assets/js/5.ea3a467f.js" defer></script><script src="/assets/js/12.725de989.js" defer></script>
  </body>
</html>
